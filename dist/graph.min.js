"use strict";class GraphNode{constructor(a){this.id=a.id,this.name=a.name,this.links={source:[],target:[]},this.nodeOptions=a}addLink(a,b){let c=this.links[a];c.includes(b)||c.push(b)}getInCount(){return this.links.target.length}getOutCount(){return this.links.source.length}getTargetNodes(){let{links:a}=this;return a.source.map(a=>a.targetNode)}setLayoutNode(a){return this.layoutNode=a}}GraphNode.nodeMap={};const GraphNodeCreator={create(a){let{id:b}=a,c=!!GraphNode.nodeMap[b],d=GraphNode.nodeMap[b]||new GraphNode(a);return c||(GraphNode.nodeMap[b]=d),{exist:c,node:d}}},linkMap={};class GraphLink{constructor(a,b){let{source:c,target:d}=a,{nodes:e}=b;this.linkOption=this.mergeLinkOptions(a,b),this.id=`${c}#!#@#${d}`,this.sourceNode=this.buildNode("source",a.source,e),this.targetNode=this.buildNode("target",a.target,e)}buildNode(a,b,c){let d=GraphNodeCreator.create(c.find(a=>a.id===b));return d.node.addLink(a,this),d.node}mergeLinkOptions(a,b){let{linkConfig:c}=b;return Object.assign({linkType:"curve"},c||{},a)}}const GraphLinkCreator={create(a,b){let{source:c,target:d}=a,e=`${c}#!#@#${d}`,f=!!linkMap[e],g=linkMap[e]||new GraphLink(a,b);return f&&(linkMap[e]=g),{exist:f,link:g}}};function createSvgElement(a){let b=document.createElementNS("http://www.w3.org/2000/svg",a);return"svg"===a&&setAttributes(b,{xmlns:"http://www.w3.org/2000/svg",version:"1.1"}),b}function setSvgAttribute(a,b,c){a.setAttributeNS("http://www.w3.org/2000/svg",b,c)}function setSvgAttributes(a,b){for(let c in b){let d=b[c];setSvgAttribute(a,c,d)}}function setAttributes(a,b){for(let c in b){let d=b[c];a.setAttribute(c,d)}}function setElemStyle(a,b){Object.assign(a.style,b)}const symbols=[{type:"icon",id:"sql_icon",color:"#dc254c",create(){let a=createSvgElement("symbol"),b=createSvgElement("title"),c=createSvgElement("g"),d=createSvgElement("path");return setSvgAttributes(a,{width:"24px",height:"24px",viewBox:"0 0 24 24",id:this.id}),b.innerHTML="sql",setSvgAttributes(c,{id:"sql",transform:"translate(3, 3)"}),setSvgAttributes(d,{d:`M8.859,18 
                C1.252,18 0,15.158 0,15.158 
                L0,12.451 C0,12.451 0.984,15.697 8.967,15.697 
                C16.951,15.697 18,12.316 18,12.316 
                L18,15.022 C18,15.022 16.467,18 8.859,18 
                L8.859,18 Z M8.859,13.263 C1.252,13.263 0,10.421 0,10.421 
                L0,7.714 C0,7.714 1.016,10.991 9,10.991 
                C16.984,10.991 18,7.579 18,7.579 L18,10.286 
                C18,10.286 16.467,13.263 8.859,13.263 
                L8.859,13.263 Z M8.859,8.526 
                C1.252,8.526 0,5.729 0,5.729 L0,3.064 
                C0,3.064 0.005,3.076 0.014,3.097 
                C0.164,1.378 4.125,0 9,0 
                C13.778,0 17.676,1.324 17.971,2.995 
                C17.989,2.958 18,2.931 18,2.931 L18,5.595 
                C18,5.595 16.467,8.526 8.859,8.526 L8.859,8.526 
                Z M9,1.895 C5.134,1.895 2,2.955 2,4.263 
                C2,5.571 5.134,6.632 9,6.632 C12.866,6.632 16,5.571 16,4.263 
                C16,2.955 12.866,1.895 9,1.895 L9,1.895 Z`,id:"Shape"}),c.appendChild(d),a.appendChild(b),a.appendChild(c),a}},{type:"icon",id:"spark_icon",color:"#d9b70a",create(){let a=createSvgElement("symbol"),b=createSvgElement("title"),c=createSvgElement("g"),d=createSvgElement("g"),e=createSvgElement("g"),f=createSvgElement("path");return setSvgAttributes(a,{width:"24px",height:"24px",viewBox:"0 0 24 24",id:this.id}),b.innerHTML="spark",setSvgAttributes(c,{id:"spark",transform:"translate(-223, -123)"}),setSvgAttributes(d,{id:"result",transform:"translate(118, 127)"}),setSvgAttributes(e,{id:"script",transform:"translate(77, 98)"}),setSvgAttributes(f,{d:`M238.737733,136.72389 L242.428948,133.095572 L237.310021,132.329843 L234.999934,127.698078 L232.689848,132.329843 L227.57092,133.095572 L231.262135,136.72389 L230.408551,141.828902 L234.999934,139.43956 L239.591318,141.828902 L238.737733,136.72389 Z M234.999934,141.625468 L229.579277,144.446362 C229.104288,144.693545 228.518853,144.508871 228.27167,144.033883 C228.174524,143.847206 228.140753,143.633988 228.175459,143.426428 L229.183213,137.399372 L224.825308,133.115725 C224.443444,132.740368 224.438169,132.126518 224.813526,131.744654 C224.961047,131.594576 225.153393,131.496571 225.361519,131.465438 L231.405003,130.561407 L234.132327,125.093073 C234.37131,124.613906 234.953486,124.4192 235.432652,124.658183 C235.620971,124.752107 235.773618,124.904754 235.867542,125.093073 L238.594866,130.561407 L244.63835,131.465438 C245.167914,131.544654 245.532993,132.038168 245.453777,132.567733 C245.422644,132.775859 245.324639,132.968204 245.174561,133.115725 L240.816656,137.399372 L241.82441,143.426428 C241.912715,143.954553 241.556171,144.454268 241.028046,144.542573 C240.820486,144.577278 240.607269,144.543508 240.420592,144.446362 L234.999934,141.625468 Z`,id:"Star","fill-rule":"nonzero"}),c.appendChild(d),c.appendChild(e),c.appendChild(f),a.appendChild(b),a.appendChild(c),a}},{id:"top_anchor",create(){let a=createSvgElement("symbol"),b=createSvgElement("title"),c=createSvgElement("g"),d=createSvgElement("path");return setSvgAttributes(a,{width:"12px",height:"12px",viewBox:"0 0 12 12",id:this.id}),b.innerHTML="arrow",setSvgAttributes(c,{id:"arrow"}),setSvgAttributes(d,{d:`M0,12 L0,4.5 C0,2.015 2.015,0 4.5,0 L7.5,0 C9.985,0 12,2.015 12,4.5 L12,12 L0,12 L0,12 Z M8.828,4.586 L6,7.414 L3.172,4.586 L1.757,6 L4.586,8.828 L4.586,8.828 L6,10.243 L7.414,8.828 L7.414,8.828 L10.243,6 L8.828,4.586 L8.828,4.586 Z`,id:"Shape"}),c.appendChild(b),c.appendChild(d),a.appendChild(c),a}}],IconMap=symbols.filter(a=>"icon"===a.type).reduce((a,b)=>(a[b.id]=b,a),{});function getTextLength(a,b){let c=/[^\x00-\xff]/,d=0,e=a.length-1;for(let f=0;f<a.length;f++)d+=c.test(a[f])?2:1,d>=b&&(e=f,b=3*a.length);return{length:d,index:e}}function textEllipsis(a,b){let{length:c,index:d}=getTextLength(a,b);return c>b?a.slice(0,d-2)+"...":a}function mergeObject(a,b,c){let d=function(a,b){let c="undefined"==typeof b?a:b;return c},e=function(){var a=function(b,c){for(var e in c)"object"!=typeof b[e]||"object"!=typeof c[e]?b[e]=d(b[e],c[e]):a(b[e],c[e]);return b};return function(){var b=[].slice.call(arguments,0),c=b[0];return b.slice(1).forEach(function(b){a(c,b)}),c}}();return c?e({},a,b):Object.assign({},a,b)}class LayoutNode{constructor(a,b,c){this.graphNode=a,this.info=b,this.globalNodeConfig=c,this.nodeConfig=mergeObject(c,a.nodeOptions,!0),this.defaultConfig={width:200,height:32,rx:2,ry:2,startPointSize:14,endPointSize:12}}getWidth(){return this.defaultConfig.width}getLeft(){return this.info.left}addLeft(a){this.info.left+=a}createElement(){let{graphNode:a,nodeConfig:b}=this,c=this.createWraper(),d=this.createRect(),e=this.createText();if(c.appendChild(d),c.appendChild(e),IconMap[b.icon&&b.icon.id]){let a=this.createIcon(b.icon);c.appendChild(a)}if(this.nodeWraper=c,this.nodeRect=d,this.nodeText=e,a.links.source.length){let a=this.creatStartPoint();c.appendChild(a),this.nodeStartPoint=a}if(a.links.target.length){let a=this.creatEndPoint();c.appendChild(a),this.nodeEndPoint=a}return c}createIcon(a){let{height:b}=this.defaultConfig,{left:c,top:d}=this.info,e=createSvgElement("use");return setSvgAttributes(e,{href:`#${a.id}`,x:c+5,y:d+(b-20)/2,width:20,height:20}),setElemStyle(e,{fill:a.color||IconMap[a.id].color}),e}createWraper(){const{width:a,height:b,rx:c,ry:d}=this.defaultConfig,{id:e,name:f}=this.graphNode;let g=createSvgElement("g");return setSvgAttributes(g,{id:`nodeWraper_${e}`,class:"nodeWraper","data-name":f,width:a,height:b,rx:c,ry:d}),g}createRect(){const{width:a,height:b,rx:c,ry:d}=this.defaultConfig,{top:e,left:f}=this.info;let g=createSvgElement("rect");return setSvgAttributes(g,{width:a,height:b,x:f,y:e,rx:c,ry:d,class:"nodeRect"}),setElemStyle(g,{stroke:"#999",strokeWidth:"1",cursor:"grab",fill:"#fff",boxSizing:"border-box"}),g}createText(){const{graphNode:a}=this,{top:b,left:c}=this.info,d=mergeObject(this.globalNodeConfig,a.nodeOptions,!0);let e=createSvgElement("text");return setSvgAttributes(e,{fontFamily:"Helvetica, Arial, sans-serif, \u5FAE\u8F6F\u96C5\u9ED1",fill:"#ebebeb",x:c+30,y:b+17,dy:".3em"}),setElemStyle(e,{fill:"#333"}),e.innerHTML=d.formatter(a),e}creatStartPoint(){let{width:a,startPointSize:b,height:c}=this.defaultConfig,{left:d,top:e}=this.info,f=createSvgElement("g"),g=createSvgElement("path"),h=createSvgElement("circle"),i={lx:d+(a-b)/2,ly:e+c,rx:d+(a+b)/2,ry:e+c,r:b/2};return setSvgAttributes(g,{d:`M ${i.lx} ${i.ly} A ${i.r} ${i.r} 0 0 0 ${i.rx} ${i.ry}`}),setElemStyle(g,{fill:"#B1B6C0",stroke:"#B1B6C0"}),f.appendChild(g),setSvgAttributes(h,{r:b/2+1,cx:i.lx+b/2,cy:i.ly,fill:"transparent"}),setElemStyle(h,{cursor:"pointer"}),f.appendChild(h),f}creatEndPoint(){let{width:a,endPointSize:b}=this.defaultConfig,{left:c,top:d}=this.info,e=createSvgElement("g"),f=createSvgElement("use"),g={lx:c+(a-b)/2,ly:d-16};return setSvgAttributes(f,{href:"#top_anchor",width:b,height:"21",x:g.lx,y:g.ly}),setElemStyle(f,{fill:"#B1B6C0",cursor:"pointer"}),e.appendChild(f),e}}class LayoutLink{constructor(a){this.graphLink=a}createElement(a){const{graphLink:b}=this,{sourceNode:c,targetNode:d}=b,e=a[c.id],f=a[d.id];let h=createSvgElement("g"),g=createSvgElement("path"),i=this.getNodePosition(e).bottomMiddle,j=this.getNodePosition(f).topMiddle;return this.strokeByLineType(g,{sourcePos:i,targetPos:j}),setSvgAttributes(g,{class:"nodeLink","data-source":b.sourceNode.name,"data-target":b.targetNode.name}),setElemStyle(g,{stroke:"#B1B6C0",fill:"none",strokeWidth:"2px",strokeLinecap:"round",cursor:"pointer"}),h.appendChild(g),h}getNodePosition(a){let b={x:a.info.left+a.defaultConfig.width/2,y:a.info.top-a.defaultConfig.endPointSize},c={x:b.x,y:a.info.top+a.defaultConfig.height+a.defaultConfig.startPointSize/2};return{topMiddle:b,bottomMiddle:c}}strokeByLineType(a,{targetPos:b,sourcePos:c}){const{graphLink:d}=this,{linkOption:{linkType:e}}=d;"curve"===e&&setSvgAttributes(a,{d:`M ${b.x} ${b.y} 
                Q ${b.x} ${(c.y+b.y)/2}, ${(c.x+b.x)/2} ${(c.y+b.y)/2} 
                T ${c.x} ${c.y}`,strokeLinejoin:"round"}),"line"===e&&setSvgAttributes(a,{d:`M ${b.x} ${b.y}, 
                L ${c.x} ${c.y}`})}}!function b(c,d,e){function a(g,i){if(!d[g]){if(!c[g]){var j="function"==typeof require&&require;if(!i&&j)return j(g,!0);if(f)return f(g,!0);var k=new Error("Cannot find module '"+g+"'");throw k.code="MODULE_NOT_FOUND",k}var l=d[g]={exports:{}};c[g][0].call(l.exports,function(b){var d=c[g][1][b];return a(d?d:b)},l,l.exports,b,c,d,e)}return d[g].exports}for(var f="function"==typeof require&&require,g=0;g<e.length;g++)a(e[g]);return a}({1:[function(a,b){var c=a("./svg-pan-zoom.js");!function(a){"function"==typeof define&&define.amd?define("svg-pan-zoom",function(){return c}):"undefined"!=typeof b&&b.exports&&(b.exports=c,a.svgPanZoom=c)}(window,document)},{"./svg-pan-zoom.js":4}],2:[function(a,b){var c=a("./svg-utilities");b.exports={enable:function(a){var b=a.svg.querySelector("defs");b||(b=document.createElementNS(c.svgNS,"defs"),a.svg.appendChild(b));var d=b.querySelector("style#svg-pan-zoom-controls-styles");if(!d){var f=document.createElementNS(c.svgNS,"style");f.setAttribute("id","svg-pan-zoom-controls-styles"),f.setAttribute("type","text/css"),f.textContent=".svg-pan-zoom-control { cursor: pointer; fill: black; fill-opacity: 0.333; } .svg-pan-zoom-control:hover { fill-opacity: 0.8; } .svg-pan-zoom-control-background { fill: white; fill-opacity: 0.5; } .svg-pan-zoom-control-background { fill-opacity: 0.8; }",b.appendChild(f)}var g=document.createElementNS(c.svgNS,"g");g.setAttribute("id","svg-pan-zoom-controls"),g.setAttribute("transform","translate("+(a.width-70)+" "+(a.height-76)+") scale(0.75)"),g.setAttribute("class","svg-pan-zoom-control"),g.appendChild(this._createZoomIn(a)),g.appendChild(this._createZoomReset(a)),g.appendChild(this._createZoomOut(a)),a.svg.appendChild(g),a.controlIcons=g},_createZoomIn:function(a){var b=document.createElementNS(c.svgNS,"g");b.setAttribute("id","svg-pan-zoom-zoom-in"),b.setAttribute("transform","translate(30.5 5) scale(0.015)"),b.setAttribute("class","svg-pan-zoom-control"),b.addEventListener("click",function(){a.getPublicInstance().zoomIn()},!1),b.addEventListener("touchstart",function(){a.getPublicInstance().zoomIn()},!1);var d=document.createElementNS(c.svgNS,"rect");d.setAttribute("x","0"),d.setAttribute("y","0"),d.setAttribute("width","1500"),d.setAttribute("height","1400"),d.setAttribute("class","svg-pan-zoom-control-background"),b.appendChild(d);var e=document.createElementNS(c.svgNS,"path");return e.setAttribute("d","M1280 576v128q0 26 -19 45t-45 19h-320v320q0 26 -19 45t-45 19h-128q-26 0 -45 -19t-19 -45v-320h-320q-26 0 -45 -19t-19 -45v-128q0 -26 19 -45t45 -19h320v-320q0 -26 19 -45t45 -19h128q26 0 45 19t19 45v320h320q26 0 45 19t19 45zM1536 1120v-960 q0 -119 -84.5 -203.5t-203.5 -84.5h-960q-119 0 -203.5 84.5t-84.5 203.5v960q0 119 84.5 203.5t203.5 84.5h960q119 0 203.5 -84.5t84.5 -203.5z"),e.setAttribute("class","svg-pan-zoom-control-element"),b.appendChild(e),b},_createZoomReset:function(a){var b=document.createElementNS(c.svgNS,"g");b.setAttribute("id","svg-pan-zoom-reset-pan-zoom"),b.setAttribute("transform","translate(5 35) scale(0.4)"),b.setAttribute("class","svg-pan-zoom-control"),b.addEventListener("click",function(){a.getPublicInstance().reset()},!1),b.addEventListener("touchstart",function(){a.getPublicInstance().reset()},!1);var d=document.createElementNS(c.svgNS,"rect");d.setAttribute("x","2"),d.setAttribute("y","2"),d.setAttribute("width","182"),d.setAttribute("height","58"),d.setAttribute("class","svg-pan-zoom-control-background"),b.appendChild(d);var e=document.createElementNS(c.svgNS,"path");e.setAttribute("d","M33.051,20.632c-0.742-0.406-1.854-0.609-3.338-0.609h-7.969v9.281h7.769c1.543,0,2.701-0.188,3.473-0.562c1.365-0.656,2.048-1.953,2.048-3.891C35.032,22.757,34.372,21.351,33.051,20.632z"),e.setAttribute("class","svg-pan-zoom-control-element"),b.appendChild(e);var f=document.createElementNS(c.svgNS,"path");return f.setAttribute("d","M170.231,0.5H15.847C7.102,0.5,0.5,5.708,0.5,11.84v38.861C0.5,56.833,7.102,61.5,15.847,61.5h154.384c8.745,0,15.269-4.667,15.269-10.798V11.84C185.5,5.708,178.976,0.5,170.231,0.5z M42.837,48.569h-7.969c-0.219-0.766-0.375-1.383-0.469-1.852c-0.188-0.969-0.289-1.961-0.305-2.977l-0.047-3.211c-0.03-2.203-0.41-3.672-1.142-4.406c-0.732-0.734-2.103-1.102-4.113-1.102h-7.05v13.547h-7.055V14.022h16.524c2.361,0.047,4.178,0.344,5.45,0.891c1.272,0.547,2.351,1.352,3.234,2.414c0.731,0.875,1.31,1.844,1.737,2.906s0.64,2.273,0.64,3.633c0,1.641-0.414,3.254-1.242,4.84s-2.195,2.707-4.102,3.363c1.594,0.641,2.723,1.551,3.387,2.73s0.996,2.98,0.996,5.402v2.32c0,1.578,0.063,2.648,0.19,3.211c0.19,0.891,0.635,1.547,1.333,1.969V48.569z M75.579,48.569h-26.18V14.022h25.336v6.117H56.454v7.336h16.781v6H56.454v8.883h19.125V48.569z M104.497,46.331c-2.44,2.086-5.887,3.129-10.34,3.129c-4.548,0-8.125-1.027-10.731-3.082s-3.909-4.879-3.909-8.473h6.891c0.224,1.578,0.662,2.758,1.316,3.539c1.196,1.422,3.246,2.133,6.15,2.133c1.739,0,3.151-0.188,4.236-0.562c2.058-0.719,3.087-2.055,3.087-4.008c0-1.141-0.504-2.023-1.512-2.648c-1.008-0.609-2.607-1.148-4.796-1.617l-3.74-0.82c-3.676-0.812-6.201-1.695-7.576-2.648c-2.328-1.594-3.492-4.086-3.492-7.477c0-3.094,1.139-5.664,3.417-7.711s5.623-3.07,10.036-3.07c3.685,0,6.829,0.965,9.431,2.895c2.602,1.93,3.966,4.73,4.093,8.402h-6.938c-0.128-2.078-1.057-3.555-2.787-4.43c-1.154-0.578-2.587-0.867-4.301-0.867c-1.907,0-3.428,0.375-4.565,1.125c-1.138,0.75-1.706,1.797-1.706,3.141c0,1.234,0.561,2.156,1.682,2.766c0.721,0.406,2.25,0.883,4.589,1.43l6.063,1.43c2.657,0.625,4.648,1.461,5.975,2.508c2.059,1.625,3.089,3.977,3.089,7.055C108.157,41.624,106.937,44.245,104.497,46.331z M139.61,48.569h-26.18V14.022h25.336v6.117h-18.281v7.336h16.781v6h-16.781v8.883h19.125V48.569z M170.337,20.14h-10.336v28.43h-7.266V20.14h-10.383v-6.117h27.984V20.14z"),f.setAttribute("class","svg-pan-zoom-control-element"),b.appendChild(f),b},_createZoomOut:function(a){var b=document.createElementNS(c.svgNS,"g");b.setAttribute("id","svg-pan-zoom-zoom-out"),b.setAttribute("transform","translate(30.5 70) scale(0.015)"),b.setAttribute("class","svg-pan-zoom-control"),b.addEventListener("click",function(){a.getPublicInstance().zoomOut()},!1),b.addEventListener("touchstart",function(){a.getPublicInstance().zoomOut()},!1);var d=document.createElementNS(c.svgNS,"rect");d.setAttribute("x","0"),d.setAttribute("y","0"),d.setAttribute("width","1500"),d.setAttribute("height","1400"),d.setAttribute("class","svg-pan-zoom-control-background"),b.appendChild(d);var e=document.createElementNS(c.svgNS,"path");return e.setAttribute("d","M1280 576v128q0 26 -19 45t-45 19h-896q-26 0 -45 -19t-19 -45v-128q0 -26 19 -45t45 -19h896q26 0 45 19t19 45zM1536 1120v-960q0 -119 -84.5 -203.5t-203.5 -84.5h-960q-119 0 -203.5 84.5t-84.5 203.5v960q0 119 84.5 203.5t203.5 84.5h960q119 0 203.5 -84.5 t84.5 -203.5z"),e.setAttribute("class","svg-pan-zoom-control-element"),b.appendChild(e),b},disable:function(a){a.controlIcons&&(a.controlIcons.parentNode.removeChild(a.controlIcons),a.controlIcons=null)}}},{"./svg-utilities":5}],3:[function(a,b){var c=Math.min,d=a("./svg-utilities"),f=a("./utilities"),g=function(a,b){this.init(a,b)};g.prototype.init=function(a,b){this.viewport=a,this.options=b,this.originalState={zoom:1,x:0,y:0},this.activeState={zoom:1,x:0,y:0},this.updateCTMCached=f.proxy(this.updateCTM,this),this.requestAnimationFrame=f.createRequestAnimationFrame(this.options.refreshRate),this.viewBox={x:0,y:0,width:0,height:0},this.cacheViewBox();var c=this.processCTM();this.setCTM(c),this.updateCTM()},g.prototype.cacheViewBox=function(){var a=this.options.svg.getAttribute("viewBox");if(a){var b=a.split(/[\s\,]/).filter(function(a){return a}).map(parseFloat);this.viewBox.x=b[0],this.viewBox.y=b[1],this.viewBox.width=b[2],this.viewBox.height=b[3];var d=c(this.options.width/this.viewBox.width,this.options.height/this.viewBox.height);this.activeState.zoom=d,this.activeState.x=(this.options.width-this.viewBox.width*d)/2,this.activeState.y=(this.options.height-this.viewBox.height*d)/2,this.updateCTMOnNextFrame(),this.options.svg.removeAttribute("viewBox")}else this.simpleViewBoxCache()},g.prototype.simpleViewBoxCache=function(){var a=this.viewport.getBBox();this.viewBox.x=a.x,this.viewBox.y=a.y,this.viewBox.width=a.width,this.viewBox.height=a.height},g.prototype.getViewBox=function(){return f.extend({},this.viewBox)},g.prototype.processCTM=function(){var a=this.getCTM();if(this.options.fit||this.options.contain){var b;b=this.options.fit?c(this.options.width/this.viewBox.width,this.options.height/this.viewBox.height):Math.max(this.options.width/this.viewBox.width,this.options.height/this.viewBox.height),a.a=b,a.d=b,a.e=-this.viewBox.x*b,a.f=-this.viewBox.y*b}if(this.options.center){var d=.5*(this.options.width-(this.viewBox.width+2*this.viewBox.x)*a.a),f=.5*(this.options.height-(this.viewBox.height+2*this.viewBox.y)*a.a);a.e=d,a.f=f}return this.originalState.zoom=a.a,this.originalState.x=a.e,this.originalState.y=a.f,a},g.prototype.getOriginalState=function(){return f.extend({},this.originalState)},g.prototype.getState=function(){return f.extend({},this.activeState)},g.prototype.getZoom=function(){return this.activeState.zoom},g.prototype.getRelativeZoom=function(){return this.activeState.zoom/this.originalState.zoom},g.prototype.computeRelativeZoom=function(a){return a/this.originalState.zoom},g.prototype.getPan=function(){return{x:this.activeState.x,y:this.activeState.y}},g.prototype.getCTM=function(){var a=this.options.svg.createSVGMatrix();return a.a=this.activeState.zoom,a.b=0,a.c=0,a.d=this.activeState.zoom,a.e=this.activeState.x,a.f=this.activeState.y,a},g.prototype.setCTM=function(a){var b=this.isZoomDifferent(a),c=this.isPanDifferent(a);if(b||c){if(b&&(!1===this.options.beforeZoom(this.getRelativeZoom(),this.computeRelativeZoom(a.a))?(a.a=a.d=this.activeState.zoom,b=!1):(this.updateCache(a),this.options.onZoom(this.getRelativeZoom()))),c){var d=this.options.beforePan(this.getPan(),{x:a.e,y:a.f}),g=!1,h=!1;!1===d?(a.e=this.getPan().x,a.f=this.getPan().y,g=h=!0):f.isObject(d)&&(!1===d.x?(a.e=this.getPan().x,g=!0):f.isNumber(d.x)&&(a.e=d.x),!1===d.y?(a.f=this.getPan().y,h=!0):f.isNumber(d.y)&&(a.f=d.y)),g&&h||!this.isPanDifferent(a)?c=!1:(this.updateCache(a),this.options.onPan(this.getPan()))}(b||c)&&this.updateCTMOnNextFrame()}},g.prototype.isZoomDifferent=function(a){return this.activeState.zoom!==a.a},g.prototype.isPanDifferent=function(a){return this.activeState.x!==a.e||this.activeState.y!==a.f},g.prototype.updateCache=function(a){this.activeState.zoom=a.a,this.activeState.x=a.e,this.activeState.y=a.f},g.prototype.pendingUpdate=!1,g.prototype.updateCTMOnNextFrame=function(){this.pendingUpdate||(this.pendingUpdate=!0,this.requestAnimationFrame.call(window,this.updateCTMCached))},g.prototype.updateCTM=function(){var a=this.getCTM();d.setCTM(this.viewport,a,this.defs),this.pendingUpdate=!1,this.options.onUpdatedCTM&&this.options.onUpdatedCTM(a)},b.exports=function(a,b){return new g(a,b)}},{"./svg-utilities":5,"./utilities":7}],4:[function(b,d){var f=Math.max,g=Math.min,j=b("./uniwheel"),k=b("./control-icons"),i=b("./utilities"),m=b("./svg-utilities"),q=b("./shadow-viewport"),a=function(a,b){this.init(a,b)},r={viewportSelector:".svg-pan-zoom_viewport",panEnabled:!0,controlIconsEnabled:!1,zoomEnabled:!0,dblClickZoomEnabled:!0,mouseWheelZoomEnabled:!0,preventMouseEventsDefault:!0,zoomScaleSensitivity:.1,minZoom:.5,maxZoom:10,fit:!0,contain:!1,center:!0,refreshRate:"auto",beforeZoom:null,onZoom:null,beforePan:null,onPan:null,customEventsHandler:null,eventsListenerElement:null,onUpdatedCTM:null},l={passive:!0};a.prototype.init=function(a,b){var c=this;this.svg=a,this.defs=a.querySelector("defs"),m.setupSvgAttributes(this.svg),this.options=i.extend(i.extend({},r),b),this.state="none";var d=m.getBoundingClientRectNormalized(a);this.width=d.width,this.height=d.height,this.viewport=q(m.getOrCreateViewport(this.svg,this.options.viewportSelector),{svg:this.svg,width:this.width,height:this.height,fit:this.options.fit,contain:this.options.contain,center:this.options.center,refreshRate:this.options.refreshRate,beforeZoom:function(a,b){if(c.viewport&&c.options.beforeZoom)return c.options.beforeZoom(a,b)},onZoom:function(a){if(c.viewport&&c.options.onZoom)return c.options.onZoom(a)},beforePan:function(a,b){if(c.viewport&&c.options.beforePan)return c.options.beforePan(a,b)},onPan:function(a){if(c.viewport&&c.options.onPan)return c.options.onPan(a)},onUpdatedCTM:function(a){if(c.viewport&&c.options.onUpdatedCTM)return c.options.onUpdatedCTM(a)}});var e=this.getPublicInstance();e.setBeforeZoom(this.options.beforeZoom),e.setOnZoom(this.options.onZoom),e.setBeforePan(this.options.beforePan),e.setOnPan(this.options.onPan),e.setOnUpdatedCTM(this.options.onUpdatedCTM),this.options.controlIconsEnabled&&k.enable(this),this.lastMouseWheelEventTime=Date.now(),this.setupHandlers()},a.prototype.setupHandlers=function(){var a=this,b=null;if(this.eventListeners={mousedown:function(c){var d=a.handleMouseDown(c,b);return b=c,d},touchstart:function(c){var d=a.handleMouseDown(c,b);return b=c,d},mouseup:function(b){return a.handleMouseUp(b)},touchend:function(b){return a.handleMouseUp(b)},mousemove:function(b){return a.handleMouseMove(b)},touchmove:function(b){return a.handleMouseMove(b)},mouseleave:function(b){return a.handleMouseUp(b)},touchleave:function(b){return a.handleMouseUp(b)},touchcancel:function(b){return a.handleMouseUp(b)}},null!=this.options.customEventsHandler){this.options.customEventsHandler.init({svgElement:this.svg,eventsListenerElement:this.options.eventsListenerElement,instance:this.getPublicInstance()});var c=this.options.customEventsHandler.haltEventListeners;if(c&&c.length)for(var d=c.length-1;0<=d;d--)this.eventListeners.hasOwnProperty(c[d])&&delete this.eventListeners[c[d]]}for(var f in this.eventListeners)(this.options.eventsListenerElement||this.svg).addEventListener(f,this.eventListeners[f],!this.options.preventMouseEventsDefault&&l);this.options.mouseWheelZoomEnabled&&(this.options.mouseWheelZoomEnabled=!1,this.enableMouseWheelZoom())},a.prototype.enableMouseWheelZoom=function(){if(!this.options.mouseWheelZoomEnabled){var a=this;this.wheelListener=function(b){return a.handleMouseWheel(b)};var b=!this.options.preventMouseEventsDefault;j.on(this.options.eventsListenerElement||this.svg,this.wheelListener,b),this.options.mouseWheelZoomEnabled=!0}},a.prototype.disableMouseWheelZoom=function(){if(this.options.mouseWheelZoomEnabled){var a=!this.options.preventMouseEventsDefault;j.off(this.options.eventsListenerElement||this.svg,this.wheelListener,a),this.options.mouseWheelZoomEnabled=!1}},a.prototype.handleMouseWheel=function(b){var c=Math.abs;if(this.options.zoomEnabled&&"none"===this.state){this.options.preventMouseEventsDefault&&(b.preventDefault?b.preventDefault():b.returnValue=!1);var d=b.deltaY||1,g=Date.now()-this.lastMouseWheelEventTime,h=3+f(0,30-g);this.lastMouseWheelEventTime=Date.now(),"deltaMode"in b&&0===b.deltaMode&&b.wheelDelta&&(d=0===b.deltaY?0:c(b.wheelDelta)/b.deltaY),d=-.3<d&&.3>d?d:(0<d?1:-1)*Math.log(c(d)+10)/h;var j=this.svg.getScreenCTM().inverse(),i=m.getEventPoint(b,this.svg).matrixTransform(j),k=Math.pow(1+this.options.zoomScaleSensitivity,-1*d);this.zoomAtPoint(k,i)}},a.prototype.zoomAtPoint=function(b,c,d){var e=this.viewport.getOriginalState();d?(b=f(this.options.minZoom*e.zoom,g(this.options.maxZoom*e.zoom,b)),b/=this.getZoom()):this.getZoom()*b<this.options.minZoom*e.zoom?b=this.options.minZoom*e.zoom/this.getZoom():this.getZoom()*b>this.options.maxZoom*e.zoom&&(b=this.options.maxZoom*e.zoom/this.getZoom());var h=this.viewport.getCTM(),i=c.matrixTransform(h.inverse()),j=this.svg.createSVGMatrix().translate(i.x,i.y).scale(b).translate(-i.x,-i.y),k=h.multiply(j);k.a!==h.a&&this.viewport.setCTM(k)},a.prototype.zoom=function(a,b){this.zoomAtPoint(a,m.getSvgCenterPoint(this.svg,this.width,this.height),b)},a.prototype.publicZoom=function(a,b){b&&(a=this.computeFromRelativeZoom(a)),this.zoom(a,b)},a.prototype.publicZoomAtPoint=function(a,b,c){if(c&&(a=this.computeFromRelativeZoom(a)),"SVGPoint"!==i.getType(b)){if(!("x"in b&&"y"in b))throw new Error("Given point is invalid");b=m.createSVGPoint(this.svg,b.x,b.y)}this.zoomAtPoint(a,b,c)},a.prototype.getZoom=function(){return this.viewport.getZoom()},a.prototype.getRelativeZoom=function(){return this.viewport.getRelativeZoom()},a.prototype.computeFromRelativeZoom=function(a){return a*this.viewport.getOriginalState().zoom},a.prototype.resetZoom=function(){var a=this.viewport.getOriginalState();this.zoom(a.zoom,!0)},a.prototype.resetPan=function(){this.pan(this.viewport.getOriginalState())},a.prototype.reset=function(){this.resetZoom(),this.resetPan()},a.prototype.handleDblClick=function(a){if(this.options.preventMouseEventsDefault&&(a.preventDefault?a.preventDefault():a.returnValue=!1),this.options.controlIconsEnabled){var b=a.target.getAttribute("class")||"";if(-1<b.indexOf("svg-pan-zoom-control"))return!1}var c=a.shiftKey?1/(2*(1+this.options.zoomScaleSensitivity)):2*(1+this.options.zoomScaleSensitivity);var d=m.getEventPoint(a,this.svg).matrixTransform(this.svg.getScreenCTM().inverse());this.zoomAtPoint(c,d)},a.prototype.handleMouseDown=function(a,b){this.options.preventMouseEventsDefault&&(a.preventDefault?a.preventDefault():a.returnValue=!1),i.mouseAndTouchNormalize(a,this.svg),this.options.dblClickZoomEnabled&&i.isDblClick(a,b)?this.handleDblClick(a):(this.state="pan",this.firstEventCTM=this.viewport.getCTM(),this.stateOrigin=m.getEventPoint(a,this.svg).matrixTransform(this.firstEventCTM.inverse()))},a.prototype.handleMouseMove=function(a){if(this.options.preventMouseEventsDefault&&(a.preventDefault?a.preventDefault():a.returnValue=!1),"pan"===this.state&&this.options.panEnabled){var b=m.getEventPoint(a,this.svg).matrixTransform(this.firstEventCTM.inverse()),c=this.firstEventCTM.translate(b.x-this.stateOrigin.x,b.y-this.stateOrigin.y);this.viewport.setCTM(c)}},a.prototype.handleMouseUp=function(a){this.options.preventMouseEventsDefault&&(a.preventDefault?a.preventDefault():a.returnValue=!1),"pan"===this.state&&(this.state="none")},a.prototype.fit=function(){var a=this.viewport.getViewBox(),b=g(this.width/a.width,this.height/a.height);this.zoom(b,!0)},a.prototype.contain=function(){var a=this.viewport.getViewBox(),b=f(this.width/a.width,this.height/a.height);this.zoom(b,!0)},a.prototype.center=function(){var a=this.viewport.getViewBox(),b=.5*(this.width-(a.width+2*a.x)*this.getZoom()),c=.5*(this.height-(a.height+2*a.y)*this.getZoom());this.getPublicInstance().pan({x:b,y:c})},a.prototype.updateBBox=function(){this.viewport.simpleViewBoxCache()},a.prototype.pan=function(a){var b=this.viewport.getCTM();b.e=a.x,b.f=a.y,this.viewport.setCTM(b)},a.prototype.panBy=function(a){var b=this.viewport.getCTM();b.e+=a.x,b.f+=a.y,this.viewport.setCTM(b)},a.prototype.getPan=function(){var a=this.viewport.getState();return{x:a.x,y:a.y}},a.prototype.resize=function(){var a=m.getBoundingClientRectNormalized(this.svg);this.width=a.width,this.height=a.height;var b=this.viewport;b.options.width=this.width,b.options.height=this.height,b.processCTM(),this.options.controlIconsEnabled&&(this.getPublicInstance().disableControlIcons(),this.getPublicInstance().enableControlIcons())},a.prototype.destroy=function(){var a=this;for(var b in this.beforeZoom=null,this.onZoom=null,this.beforePan=null,this.onPan=null,this.onUpdatedCTM=null,null!=this.options.customEventsHandler&&this.options.customEventsHandler.destroy({svgElement:this.svg,eventsListenerElement:this.options.eventsListenerElement,instance:this.getPublicInstance()}),this.eventListeners)(this.options.eventsListenerElement||this.svg).removeEventListener(b,this.eventListeners[b],!this.options.preventMouseEventsDefault&&l);this.disableMouseWheelZoom(),this.getPublicInstance().disableControlIcons(),this.reset(),h=h.filter(function(b){return b.svg!==a.svg}),delete this.options,delete this.viewport,delete this.publicInstance,delete this.pi,this.getPublicInstance=function(){return null}},a.prototype.getPublicInstance=function(){var a=this;return this.publicInstance||(this.publicInstance=this.pi={enablePan:function(){return a.options.panEnabled=!0,a.pi},disablePan:function(){return a.options.panEnabled=!1,a.pi},isPanEnabled:function(){return!!a.options.panEnabled},pan:function(b){return a.pan(b),a.pi},panBy:function(b){return a.panBy(b),a.pi},getPan:function(){return a.getPan()},setBeforePan:function(b){return a.options.beforePan=null===b?null:i.proxy(b,a.publicInstance),a.pi},setOnPan:function(b){return a.options.onPan=null===b?null:i.proxy(b,a.publicInstance),a.pi},enableZoom:function(){return a.options.zoomEnabled=!0,a.pi},disableZoom:function(){return a.options.zoomEnabled=!1,a.pi},isZoomEnabled:function(){return!!a.options.zoomEnabled},enableControlIcons:function(){return a.options.controlIconsEnabled||(a.options.controlIconsEnabled=!0,k.enable(a)),a.pi},disableControlIcons:function(){return a.options.controlIconsEnabled&&(a.options.controlIconsEnabled=!1,k.disable(a)),a.pi},isControlIconsEnabled:function(){return!!a.options.controlIconsEnabled},enableDblClickZoom:function(){return a.options.dblClickZoomEnabled=!0,a.pi},disableDblClickZoom:function(){return a.options.dblClickZoomEnabled=!1,a.pi},isDblClickZoomEnabled:function(){return!!a.options.dblClickZoomEnabled},enableMouseWheelZoom:function(){return a.enableMouseWheelZoom(),a.pi},disableMouseWheelZoom:function(){return a.disableMouseWheelZoom(),a.pi},isMouseWheelZoomEnabled:function(){return!!a.options.mouseWheelZoomEnabled},setZoomScaleSensitivity:function(b){return a.options.zoomScaleSensitivity=b,a.pi},setMinZoom:function(b){return a.options.minZoom=b,a.pi},setMaxZoom:function(b){return a.options.maxZoom=b,a.pi},setBeforeZoom:function(b){return a.options.beforeZoom=null===b?null:i.proxy(b,a.publicInstance),a.pi},setOnZoom:function(b){return a.options.onZoom=null===b?null:i.proxy(b,a.publicInstance),a.pi},zoom:function(b){return a.publicZoom(b,!0),a.pi},zoomBy:function(b){return a.publicZoom(b,!1),a.pi},zoomAtPoint:function(b,c){return a.publicZoomAtPoint(b,c,!0),a.pi},zoomAtPointBy:function(b,c){return a.publicZoomAtPoint(b,c,!1),a.pi},zoomIn:function(){return this.zoomBy(1+a.options.zoomScaleSensitivity),a.pi},zoomOut:function(){return this.zoomBy(1/(1+a.options.zoomScaleSensitivity)),a.pi},getZoom:function(){return a.getRelativeZoom()},setOnUpdatedCTM:function(b){return a.options.onUpdatedCTM=null===b?null:i.proxy(b,a.publicInstance),a.pi},resetZoom:function(){return a.resetZoom(),a.pi},resetPan:function(){return a.resetPan(),a.pi},reset:function(){return a.reset(),a.pi},fit:function(){return a.fit(),a.pi},contain:function(){return a.contain(),a.pi},center:function(){return a.center(),a.pi},updateBBox:function(){return a.updateBBox(),a.pi},resize:function(){return a.resize(),a.pi},getSizes:function(){return{width:a.width,height:a.height,realZoom:a.getZoom(),viewBox:a.viewport.getViewBox()}},destroy:function(){return a.destroy(),a.pi}}),this.publicInstance};var h=[],e=function(b,c){var d=i.getSvg(b);if(null===d)return null;for(var e=h.length-1;0<=e;e--)if(h[e].svg===d)return h[e].instance.getPublicInstance();return h.push({svg:d,instance:new a(d,c)}),h[h.length-1].instance.getPublicInstance()};d.exports=e},{"./control-icons":2,"./shadow-viewport":3,"./svg-utilities":5,"./uniwheel":6,"./utilities":7}],5:[function(a,b){var c=a("./utilities"),d="unknown";document.documentMode&&(d="ie"),b.exports={svgNS:"http://www.w3.org/2000/svg",xmlNS:"http://www.w3.org/XML/1998/namespace",xmlnsNS:"http://www.w3.org/2000/xmlns/",xlinkNS:"http://www.w3.org/1999/xlink",evNS:"http://www.w3.org/2001/xml-events",getBoundingClientRectNormalized:function(a){if(a.clientWidth&&a.clientHeight)return{width:a.clientWidth,height:a.clientHeight};if(a.getBoundingClientRect())return a.getBoundingClientRect();throw new Error("Cannot get BoundingClientRect for SVG.")},getOrCreateViewport:function(b,d){var e=null;if(e=c.isElement(d)?d:b.querySelector(d),!e){var f=Array.prototype.slice.call(b.childNodes||b.children).filter(function(a){return"defs"!==a.nodeName&&"#text"!==a.nodeName});1===f.length&&"g"===f[0].nodeName&&null===f[0].getAttribute("transform")&&(e=f[0])}if(!e){var g="viewport-"+new Date().toISOString().replace(/\D/g,"");e=document.createElementNS(this.svgNS,"g"),e.setAttribute("id",g);var h=b.childNodes||b.children;if(h&&0<h.length)for(var i=h.length;0<i;i--)"defs"!==h[h.length-i].nodeName&&e.appendChild(h[h.length-i]);b.appendChild(e)}var j=[];return e.getAttribute("class")&&(j=e.getAttribute("class").split(" ")),~j.indexOf("svg-pan-zoom_viewport")||(j.push("svg-pan-zoom_viewport"),e.setAttribute("class",j.join(" "))),e},setupSvgAttributes:function(a){if(a.setAttribute("xmlns",this.svgNS),a.setAttributeNS(this.xmlnsNS,"xmlns:xlink",this.xlinkNS),a.setAttributeNS(this.xmlnsNS,"xmlns:ev",this.evNS),null!==a.parentNode){var b=a.getAttribute("style")||"";-1===b.toLowerCase().indexOf("overflow")&&a.setAttribute("style","overflow: hidden; "+b)}},internetExplorerRedisplayInterval:300,refreshDefsGlobal:c.throttle(function(){for(var a,b=document.querySelectorAll("defs"),c=b.length,d=0;d<c;d++)a=b[d],a.parentNode.insertBefore(a,a)},this?this.internetExplorerRedisplayInterval:null),setCTM:function(a,b,c){var e=this,f="matrix("+b.a+","+b.b+","+b.c+","+b.d+","+b.e+","+b.f+")";a.setAttributeNS(null,"transform",f),"transform"in a.style?a.style.transform=f:"-ms-transform"in a.style?a.style["-ms-transform"]=f:"-webkit-transform"in a.style&&(a.style["-webkit-transform"]=f),"ie"==d&&c&&(c.parentNode.insertBefore(c,c),window.setTimeout(function(){e.refreshDefsGlobal()},e.internetExplorerRedisplayInterval))},getEventPoint:function(a,b){var d=b.createSVGPoint();return c.mouseAndTouchNormalize(a,b),d.x=a.clientX,d.y=a.clientY,d},getSvgCenterPoint:function(a,b,c){return this.createSVGPoint(a,b/2,c/2)},createSVGPoint:function(a,b,c){var d=a.createSVGPoint();return d.x=b,d.y=c,d}}},{"./utilities":7}],6:[function(a,b){b.exports=function(){function b(a,b){var c=function(a){a||(a=window.event);var c={originalEvent:a,target:a.target||a.srcElement,type:"wheel",deltaMode:"MozMousePixelScroll"==a.type?0:1,deltaX:0,delatZ:0,preventDefault:function(){a.preventDefault?a.preventDefault():a.returnValue=!1}};return"mousewheel"==q?(c.deltaY=-.025*a.wheelDelta,a.wheelDeltaX&&(c.deltaX=-.025*a.wheelDeltaX)):c.deltaY=a.detail,b(c)};return n.push({element:a,fn:c}),c}function d(a){for(var b=0;b<n.length;b++)if(n[b].element===a)return n[b].fn;return function(){}}function e(a){for(var b=0;b<n.length;b++)if(n[b].element===a)return n.splice(b,1)}function f(a,d,e,f){var g;g="wheel"===q?e:b(a,e),a[k](v+d,g,!!f&&c)}function g(a,b,f,g){var h;h="wheel"===q?f:d(a),a[m](v+b,h,!!g&&c),e(a)}function i(a,b,c){f(a,q,b,c),"DOMMouseScroll"==q&&f(a,"MozMousePixelScroll",b,c)}function j(a,b,c){g(a,q,b,c),"DOMMouseScroll"==q&&g(a,"MozMousePixelScroll",b,c)}var k,m,q,v="",n=[],c={passive:!0};return window.addEventListener?(k="addEventListener",m="removeEventListener"):(k="attachEvent",m="detachEvent",v="on"),q="onwheel"in document.createElement("div")?"wheel":void 0===document.onmousewheel?"DOMMouseScroll":"mousewheel",{on:i,off:j}}()},{}],7:[function(a,b){var d=Math.pow;function c(a){return function(b){window.setTimeout(b,a)}}b.exports={extend:function(a,b){for(var c in a=a||{},b)a[c]=this.isObject(b[c])?this.extend(a[c],b[c]):b[c];return a},isElement:function(a){return a instanceof HTMLElement||a instanceof SVGElement||a instanceof SVGSVGElement||a&&"object"==typeof a&&null!==a&&1===a.nodeType&&"string"==typeof a.nodeName},isObject:function(a){return"[object Object]"===Object.prototype.toString.call(a)},isNumber:function(a){return!isNaN(parseFloat(a))&&isFinite(a)},getSvg:function(a){var b,c;if(this.isElement(a))b=a;else{if(!("string"==typeof a||a instanceof String))throw new Error("Provided selector is not an HTML object nor String");if(b=document.querySelector(a),!b)throw new Error("Provided selector did not find any elements. Selector: "+a)}if("svg"===b.tagName.toLowerCase())c=b;else if("object"===b.tagName.toLowerCase())c=b.contentDocument.documentElement;else{if("embed"!==b.tagName.toLowerCase())throw"img"===b.tagName.toLowerCase()?new Error("Cannot script an SVG in an \"img\" element. Please use an \"object\" element or an in-line SVG."):new Error("Cannot get SVG.");c=b.getSVGDocument().documentElement}return c},proxy:function(a,b){return function(){return a.apply(b,arguments)}},getType:function(a){return Object.prototype.toString.apply(a).replace(/^\[object\s/,"").replace(/\]$/,"")},mouseAndTouchNormalize:function(a,b){if(void 0===a.clientX||null===a.clientX)if(!(a.clientX=0,a.clientY=0,void 0!==a.touches&&a.touches.length))void 0!==a.originalEvent&&void 0!==a.originalEvent.clientX&&(a.clientX=a.originalEvent.clientX,a.clientY=a.originalEvent.clientY);else if(void 0!==a.touches[0].clientX)a.clientX=a.touches[0].clientX,a.clientY=a.touches[0].clientY;else if(void 0!==a.touches[0].pageX){var c=b.getBoundingClientRect();a.clientX=a.touches[0].pageX-c.left,a.clientY=a.touches[0].pageY-c.top}},isDblClick:function(a,b){var c=Math.sqrt;if(2===a.detail)return!0;if(void 0!==b&&null!==b){var e=a.timeStamp-b.timeStamp,f=c(d(a.clientX-b.clientX,2)+d(a.clientY-b.clientY,2));return 250>e&&10>f}return!1},now:Date.now||function(){return new Date().getTime()},throttle:function(b,d,e){var f,g,j,k=this,m=null,p=0;e||(e={});var q=function(){p=!1===e.leading?0:k.now(),m=null,j=b.apply(f,g),m||(f=g=null)};return function(){var a=k.now();p||!1!==e.leading||(p=a);var h=d-(a-p);return f=this,g=arguments,0>=h||h>d?(clearTimeout(m),m=null,p=a,j=b.apply(f,g),m||(f=g=null)):m||!1===e.trailing||(m=setTimeout(q,h)),j}},createRequestAnimationFrame:function(a){var b=null;return"auto"!==a&&60>a&&1<a&&(b=Math.floor(1e3/a)),null===b?window.requestAnimationFrame||c(33):c(b)}}},{}]},{},[1]);class ToolTip{constructor(a){this.type=a,this.init()}init(){this.elem=document.createElement("div"),this.arrow=document.createElement("div"),this.content=document.createElement("div"),setElemStyle(this.arrow,{position:"absolute",width:"0px",height:"0px",borderWidth:"3px",borderColor:"transparent",borderStyle:"solid",borderBottomWidth:"0px",borderTopColor:"#3d3d3d",bottom:"-3px",left:"-3px"}),setElemStyle(this.content,{backgroundColor:"#3d3d3d",color:"#fff",height:"24px",whiteSpace:"nowrap",lineHeight:"24px",transform:"translateX(-50%)",padding:"0 10px",borderRadius:"4px"}),this.elem.appendChild(this.arrow),this.elem.appendChild(this.content)}show({left:a,top:b,text:c,dx:d}){d=d||0;const{type:e}=this;let f="node"===e?`translate(${d}px, -100%)`:"translateY(-100%)";setElemStyle(this.elem,{position:"fixed",zIndex:1500,left:a+"px",top:b-8+"px",transform:f}),this.content.innerHTML=c,document.body.appendChild(this.elem)}hide(){document.body.removeChild(this.elem)}}class Layout{constructor({matrix:a,initOptions:b}){this.matrix=a,this.initOptions=b,Layout.layoutNodeMap={},this.layoutMatrix=[],this.init()}init(){let{width:a,height:b,el:c,backgroundColor:d}=this.initOptions;this.svgCanvas=createSvgElement("svg"),setSvgAttributes(this.svgCanvas,{width:a,height:b,id:"viewport"}),setElemStyle(this.svgCanvas,{backgroundColor:d});let e=this.createSymbols();e.forEach(a=>{this.svgCanvas.appendChild(a)}),this.linksWraper=createSvgElement("g"),this.rootElement=document.querySelector(c)}build({rowConfig:a,columnConfig:b,node:c}){const{matrix:d,layoutMatrix:e}=this,{gap:f,height:g}=a,{gap:h}=b;let j=0;for(let k=0;k<d.length;k++){let a=d[k],b=[],i=j,l=0;for(let d=0;d<a.length;d++){let e=a[d],f=this.buildNode(e,{i:k,j:d,rowTop:i,currentLeft:l,columnGap:h,node:c}),g=f.layoutNode;l=f.currentLeft,Layout.layoutNodeMap[e.id]=g,b.push(g)}this.setRowContentCenter(b,l-h),j+=g+f,e.push(b)}this.layoutMatrix=e}buildNode(a,{i:b,j:c,rowTop:d,currentLeft:e,columnGap:f,node:g}){let h=e,i=a.setLayoutNode(new LayoutNode(a,{rowIndex:b,columnIndex:c,top:d,left:h},g));return e+=i.getWidth()+f,{layoutNode:i,currentLeft:e}}setRowContentCenter(a,b){const{rootElement:c}=this,{width:d}=this.initOptions;let e=/%/,f=+d;e.test(d)&&(f=c.offsetWidth*(d.slice(0,-1)/100));let g=f/2-b/2;a.forEach(a=>{a.addLeft(g)})}createSymbols(){return symbols.map(a=>a.create())}renderNodes(){const{layoutMatrix:a,rootElement:b,linksWraper:c}=this;for(let b,c=0;c<a.length;c++){b=a[c];for(let a,c=0;c<b.length;c++)a=b[c],this.renderNodeLinks(a),this.svgCanvas.appendChild(a.createElement())}this.svgCanvas.appendChild(c),b.innerHTML=this.svgCanvas.outerHTML}renderNodeLinks(a){let{linksWraper:b}=this;const{source:c}=a.graphNode.links;c.forEach(a=>{let c=new LayoutLink(a);b.appendChild(c.createElement(Layout.layoutNodeMap))})}render(){this.renderNodes(),this.addEventListeners(),this.setSVGPanZoom()}addEventListeners(){let a=document.querySelector("#viewport");[...a.querySelectorAll(".nodeWraper")].forEach(a=>{let b=new ToolTip("node"),c=a.querySelector(".nodeRect");a.addEventListener("mouseenter",()=>{let{name:d}=a.dataset,{left:e,top:f,width:g}=c.getBoundingClientRect();b.show({left:e,top:f,text:d,dx:g/2})}),a.addEventListener("mouseleave",()=>{b.hide()})}),[...a.querySelectorAll(".nodeLink")].forEach(a=>{let b=new ToolTip("link");a.addEventListener("mouseenter",c=>{b.show({left:c.clientX,top:c.clientY,text:`${a.dataset.source} --> ${a.dataset.target}`})}),a.addEventListener("mouseleave",()=>{b.hide()})})}setSVGPanZoom(){const{svgPanZoomConfig:a}=this.initOptions;svgPanZoom("#viewport",a)}}Layout.layoutNodeMap={};class GraphRenderer{constructor(a={}){this.initOptions=this.mergeInitOptions(a)}mergeInitOptions(a){let b={width:"100%",height:"100%",backgroundColor:"transparent",svgPanZoomConfig:{controlIconsEnabled:!0}},c={svgPanZoomConfig:mergeObject(b.svgPanZoomConfig,a.svgPanZoomConfig,!0)};return Object.assign(b,a,c)}mergeRenderOptions(a){let{nodes:b,links:c}=a,d={linkConfig:{linkType:"curve"},rowConfig:{gap:100,height:35},columnConfig:{gap:20},node:{icon:{id:"spark_icon"},formatter(a){return textEllipsis(a.name,20)}}};return this.renderOptions={linkConfig:mergeObject(d.linkConfig,a.linkConfig,!0),rowConfig:mergeObject(d.rowConfig,a.rowConfig,!0),columnConfig:mergeObject(d.columnConfig,a.columnConfig,!0),nodes:b,links:c,node:mergeObject(d.node,a.node,!0)}}render(a={}){const{nodes:b,links:c}=this.mergeRenderOptions(a);b.length&&c.length&&(this.reset(),this.build(this.renderOptions))}reset(){GraphNode.nodeMap={},Layout.layoutNodeMap={}}build(a){const{nodes:b,links:c,linkConfig:d,rowConfig:e,columnConfig:f,node:g}=a;let h=c.reduce((a,c)=>{let{exist:e,link:f}=GraphLinkCreator.create(c,{nodes:b,linkConfig:d});return e||a.push(f),a},[]),i={},j=h.filter(a=>{let{sourceNode:b}=a,c=b.getInCount();if(0===c&&!i[b.id])return i[b.id]=b,!0}).map(a=>a.sourceNode),k=this.layout(j);k.build({rowConfig:e,columnConfig:f,node:g}),k.render()}layout(a){let b=[a],c={},{row:d,pushToNextRow:e}=this.getRowFromParent({parentNodes:a,layoutNodeMap:c});for(;d.length;){b.push(d);let a=this.getRowFromParent({parentNodes:d,layoutNodeMap:c,readyForPush:e});d=a.row,e=a.pushToNextRow}let f=new Layout({matrix:b,initOptions:this.initOptions});return f}getRowFromParent({parentNodes:a,layoutNodeMap:b,readyForPush:c}){let d={},e=[],f={};for(let g=0;g<a.length;g++){let h=a[g],i=h.getTargetNodes();g==a.length-1&&(i=i.concat(c||[])),i.forEach(a=>{d[a.id]||b[a.id]||(f[a.id]=[],a.links.source.forEach(b=>{f[a.id].push(b.targetNode.id)}),d[a.id]=a,b[a.id]=a,e.push(a))})}let g=[];for(let d=e.length-1;0<=d;d--){let a=e[d],c=f[a.id],h=[];e.every((a,b)=>{let d=c.includes(a.id);return d&&(g.push(a),h.push(b)),d}),h.forEach(a=>{delete b[e[a].id],e.splice(a,1)})}return{row:e,pushToNextRow:g}}}var Graph={init(a){return new GraphRenderer(a)}};window.Graph=Graph;
