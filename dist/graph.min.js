(function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self,e.bundle=t())})(this,function(){"use strict";var l=Math.pow,d=Math.max,p=Math.min;function e(e){let t=document.createElementNS("http://www.w3.org/2000/svg",e);return"svg"===e&&n(t,{xmlns:"http://www.w3.org/2000/svg",version:"1.1"}),t}function t(e,t,o){e.setAttributeNS("http://www.w3.org/2000/svg",t,o)}function o(e,o){for(let n in o){let i=o[n];t(e,n,i)}}function n(e,t){for(let o in t){let n=t[o];e.setAttribute(o,n)}}function i(e,t){Object.assign(e.style,t)}function s(e,t){let o=/[^\x00-\xff]/,n=0,s=e.length-1;for(let a=0;a<e.length;a++)n+=o.test(e[a])?2:1,n>=t&&(s=a,t=3*e.length);return{length:n,index:s}}function a(e,t){let{length:o,index:n}=s(e,t);return o>t?e.slice(0,n-2)+"...":e}function r(e,t,o){let n=function(e,t){let o="undefined"==typeof t?e:t;return o},i=function(){var e=function(t,o){for(var i in o)"object"!=typeof t[i]||"object"!=typeof o[i]?t[i]=n(t[i],o[i]):e(t[i],o[i]);return t};return function(){var t=[].slice.call(arguments,0),o=t[0];return t.slice(1).forEach(function(t){e(o,t)}),o}}();return o?i({},e,t):Object.assign({},e,t)}class c{constructor(e){this.id=e.id,this.name=e.name,this.links={source:[],target:[]},this.nodeOptions=e}addLink(e,t){let o=this.links[e];o.includes(t)||o.push(t)}getInCount(){return this.links.target.length}getOutCount(){return this.links.source.length}getTargetNodes(){let{links:e}=this;return e.source.map(e=>e.targetNode)}setLayoutNode(e){return this.layoutNode=e}}c.nodeMap={};const u={create(e){let{id:t}=e,o=!!c.nodeMap[t],n=c.nodeMap[t]||new c(e);return o||(c.nodeMap[t]=n),{exist:o,node:n}}},g={};class m{constructor(e,t){let{source:o,target:n}=e,{nodes:i}=t;this.linkOption=this.mergeLinkOptions(e,t),this.id=`${o}#!#@#${n}`,this.sourceNode=this.buildNode("source",e.source,i),this.targetNode=this.buildNode("target",e.target,i)}buildNode(e,t,o){let n=u.create(o.find(e=>e.id===t));return n.node.addLink(e,this),n.node}mergeLinkOptions(e,t){let{linkConfig:o}=t;return Object.assign({linkType:"curve"},o||{},e)}}const h={create(e,t){let{source:o,target:n}=e,i=`${o}#!#@#${n}`,s=!!g[i],a=g[i]||new m(e,t);return s&&(g[i]=a),{exist:s,link:a}}},v=[{type:"icon",id:"sql_icon",color:"#dc254c",create(){let t=e("symbol"),n=e("title"),i=e("g"),s=e("path");return o(t,{width:"24px",height:"24px",viewBox:"0 0 24 24",id:this.id}),n.innerHTML="sql",o(i,{id:"sql",transform:"translate(3, 3)"}),o(s,{d:`M8.859,18 
                C1.252,18 0,15.158 0,15.158 
                L0,12.451 C0,12.451 0.984,15.697 8.967,15.697 
                C16.951,15.697 18,12.316 18,12.316 
                L18,15.022 C18,15.022 16.467,18 8.859,18 
                L8.859,18 Z M8.859,13.263 C1.252,13.263 0,10.421 0,10.421 
                L0,7.714 C0,7.714 1.016,10.991 9,10.991 
                C16.984,10.991 18,7.579 18,7.579 L18,10.286 
                C18,10.286 16.467,13.263 8.859,13.263 
                L8.859,13.263 Z M8.859,8.526 
                C1.252,8.526 0,5.729 0,5.729 L0,3.064 
                C0,3.064 0.005,3.076 0.014,3.097 
                C0.164,1.378 4.125,0 9,0 
                C13.778,0 17.676,1.324 17.971,2.995 
                C17.989,2.958 18,2.931 18,2.931 L18,5.595 
                C18,5.595 16.467,8.526 8.859,8.526 L8.859,8.526 
                Z M9,1.895 C5.134,1.895 2,2.955 2,4.263 
                C2,5.571 5.134,6.632 9,6.632 C12.866,6.632 16,5.571 16,4.263 
                C16,2.955 12.866,1.895 9,1.895 L9,1.895 Z`,id:"Shape"}),i.appendChild(s),t.appendChild(n),t.appendChild(i),t}},{type:"icon",id:"spark_icon",color:"#d9b70a",create(){let t=e("symbol"),n=e("title"),i=e("g"),s=e("g"),a=e("g"),r=e("path");return o(t,{width:"24px",height:"24px",viewBox:"0 0 24 24",id:this.id}),n.innerHTML="spark",o(i,{id:"spark",transform:"translate(-223, -123)"}),o(s,{id:"result",transform:"translate(118, 127)"}),o(a,{id:"script",transform:"translate(77, 98)"}),o(r,{d:`M238.737733,136.72389 L242.428948,133.095572 L237.310021,132.329843 L234.999934,127.698078 L232.689848,132.329843 L227.57092,133.095572 L231.262135,136.72389 L230.408551,141.828902 L234.999934,139.43956 L239.591318,141.828902 L238.737733,136.72389 Z M234.999934,141.625468 L229.579277,144.446362 C229.104288,144.693545 228.518853,144.508871 228.27167,144.033883 C228.174524,143.847206 228.140753,143.633988 228.175459,143.426428 L229.183213,137.399372 L224.825308,133.115725 C224.443444,132.740368 224.438169,132.126518 224.813526,131.744654 C224.961047,131.594576 225.153393,131.496571 225.361519,131.465438 L231.405003,130.561407 L234.132327,125.093073 C234.37131,124.613906 234.953486,124.4192 235.432652,124.658183 C235.620971,124.752107 235.773618,124.904754 235.867542,125.093073 L238.594866,130.561407 L244.63835,131.465438 C245.167914,131.544654 245.532993,132.038168 245.453777,132.567733 C245.422644,132.775859 245.324639,132.968204 245.174561,133.115725 L240.816656,137.399372 L241.82441,143.426428 C241.912715,143.954553 241.556171,144.454268 241.028046,144.542573 C240.820486,144.577278 240.607269,144.543508 240.420592,144.446362 L234.999934,141.625468 Z`,id:"Star","fill-rule":"nonzero"}),i.appendChild(s),i.appendChild(a),i.appendChild(r),t.appendChild(n),t.appendChild(i),t}},{id:"top_anchor",create(){let t=e("symbol"),n=e("title"),i=e("g"),s=e("path");return o(t,{width:"12px",height:"12px",viewBox:"0 0 12 12",id:this.id}),n.innerHTML="arrow",o(i,{id:"arrow"}),o(s,{d:`M0,12 L0,4.5 C0,2.015 2.015,0 4.5,0 L7.5,0 C9.985,0 12,2.015 12,4.5 L12,12 L0,12 L0,12 Z M8.828,4.586 L6,7.414 L3.172,4.586 L1.757,6 L4.586,8.828 L4.586,8.828 L6,10.243 L7.414,8.828 L7.414,8.828 L10.243,6 L8.828,4.586 L8.828,4.586 Z`,id:"Shape"}),i.appendChild(n),i.appendChild(s),t.appendChild(i),t}}],f=v.filter(e=>"icon"===e.type).reduce((e,t)=>(e[t.id]=t,e),{});class b{constructor(e,t,o){this.graphNode=e,this.info=t,this.globalNodeConfig=o,this.nodeConfig=r(o,e.nodeOptions,!0),this.defaultConfig={width:200,height:32,rx:2,ry:2,startPointSize:14,endPointSize:12}}getWidth(){return this.defaultConfig.width}getLeft(){return this.info.left}addLeft(e){this.info.left+=e}createElement(){let{graphNode:e,nodeConfig:t}=this,o=this.createWraper(),n=this.createRect(),i=this.createText();if(o.appendChild(n),o.appendChild(i),f[t.icon&&t.icon.id]){let e=this.createIcon(t.icon);o.appendChild(e)}if(this.nodeWraper=o,this.nodeRect=n,this.nodeText=i,e.links.source.length){let e=this.creatStartPoint();o.appendChild(e),this.nodeStartPoint=e}if(e.links.target.length){let e=this.creatEndPoint();o.appendChild(e),this.nodeEndPoint=e}return o}createIcon(t){let{height:n}=this.defaultConfig,{left:s,top:a}=this.info,r=e("use");return o(r,{href:`#${t.id}`,x:s+5,y:a+(n-20)/2,width:20,height:20}),i(r,{fill:t.color||f[t.id].color}),r}createWraper(){const{width:t,height:n,rx:i,ry:s}=this.defaultConfig,{id:a,name:r}=this.graphNode;let l=e("g");return o(l,{id:`nodeWraper_${a}`,class:"nodeWraper","data-name":r,width:t,height:n,rx:i,ry:s}),l}createRect(){const{width:t,height:n,rx:s,ry:a}=this.defaultConfig,{top:r,left:l}=this.info;let d=e("rect");return o(d,{width:t,height:n,x:l,y:r,rx:s,ry:a,class:"nodeRect"}),i(d,{stroke:"#999",strokeWidth:"1",cursor:"grab",fill:"#fff",boxSizing:"border-box"}),d}createText(){const{graphNode:t}=this,{top:n,left:s}=this.info,a=r(this.globalNodeConfig,t.nodeOptions,!0);let l=e("text");return o(l,{fontFamily:"Helvetica, Arial, sans-serif, \u5FAE\u8F6F\u96C5\u9ED1",fill:"#ebebeb",x:s+30,y:n+17,dy:".3em"}),i(l,{fill:"#333"}),l.innerHTML=a.formatter(t),l}creatStartPoint(){let{width:t,startPointSize:n,height:s}=this.defaultConfig,{left:a,top:r}=this.info,l=e("g"),d=e("path"),p=e("circle"),c={lx:a+(t-n)/2,ly:r+s,rx:a+(t+n)/2,ry:r+s,r:n/2};return o(d,{d:`M ${c.lx} ${c.ly} A ${c.r} ${c.r} 0 0 0 ${c.rx} ${c.ry}`}),i(d,{fill:"#B1B6C0",stroke:"#B1B6C0"}),l.appendChild(d),o(p,{r:n/2+1,cx:c.lx+n/2,cy:c.ly,fill:"transparent"}),i(p,{cursor:"pointer"}),l.appendChild(p),l}creatEndPoint(){let{width:t,endPointSize:n}=this.defaultConfig,{left:s,top:a}=this.info,r=e("g"),l=e("use"),d={lx:s+(t-n)/2,ly:a-16};return o(l,{href:"#top_anchor",width:n,height:"21",x:d.lx,y:d.ly}),i(l,{fill:"#B1B6C0",cursor:"pointer"}),r.appendChild(l),r}}class w{constructor(e){this.graphLink=e}createElement(t){const{graphLink:n}=this,{sourceNode:s,targetNode:a}=n,r=t[s.id],l=t[a.id];let d=e("g"),p=e("path"),c=this.getNodePosition(r).bottomMiddle,u=this.getNodePosition(l).topMiddle;return this.strokeByLineType(p,{sourcePos:c,targetPos:u}),o(p,{class:"nodeLink","data-source":n.sourceNode.name,"data-target":n.targetNode.name}),i(p,{stroke:"#B1B6C0",fill:"none",strokeWidth:"2px",strokeLinecap:"round",cursor:"pointer"}),d.appendChild(p),d}getNodePosition(e){let t={x:e.info.left+e.defaultConfig.width/2,y:e.info.top-e.defaultConfig.endPointSize},o={x:t.x,y:e.info.top+e.defaultConfig.height+e.defaultConfig.startPointSize/2};return{topMiddle:t,bottomMiddle:o}}strokeByLineType(e,{targetPos:t,sourcePos:n}){const{graphLink:i}=this,{linkOption:{linkType:s}}=i;"curve"===s&&o(e,{d:`M ${t.x} ${t.y} 
                Q ${t.x} ${(n.y+t.y)/2}, ${(n.x+t.x)/2} ${(n.y+t.y)/2} 
                T ${n.x} ${n.y}`,strokeLinejoin:"round"}),"line"===s&&o(e,{d:`M ${t.x} ${t.y}, 
                L ${n.x} ${n.y}`})}}!function d(p,e,t){function n(i,s){if(!e[i]){if(!p[i]){var a="function"==typeof require&&require;if(!s&&a)return a(i,!0);if(o)return o(i,!0);var r=new Error("Cannot find module '"+i+"'");throw r.code="MODULE_NOT_FOUND",r}var l=e[i]={exports:{}};p[i][0].call(l.exports,function(e){var t=p[i][1][e];return n(t?t:e)},l,l.exports,d,p,e,t)}return e[i].exports}for(var o="function"==typeof require&&require,i=0;i<t.length;i++)n(t[i]);return n}({1:[function(o,i){var e=o("./svg-pan-zoom.js");!function(o){"function"==typeof define&&define.amd?define("svg-pan-zoom",function(){return e}):"undefined"!=typeof i&&i.exports&&(i.exports=e,o.svgPanZoom=e)}(window,document)},{"./svg-pan-zoom.js":4}],2:[function(o,t){var a=o("./svg-utilities");t.exports={enable:function(n){var t=n.svg.querySelector("defs");t||(t=document.createElementNS(a.svgNS,"defs"),n.svg.appendChild(t));var r=t.querySelector("style#svg-pan-zoom-controls-styles");if(!r){var o=document.createElementNS(a.svgNS,"style");o.setAttribute("id","svg-pan-zoom-controls-styles"),o.setAttribute("type","text/css"),o.textContent=".svg-pan-zoom-control { cursor: pointer; fill: black; fill-opacity: 0.333; } .svg-pan-zoom-control:hover { fill-opacity: 0.8; } .svg-pan-zoom-control-background { fill: white; fill-opacity: 0.5; } .svg-pan-zoom-control-background { fill-opacity: 0.8; }",t.appendChild(o)}var i=document.createElementNS(a.svgNS,"g");i.setAttribute("id","svg-pan-zoom-controls"),i.setAttribute("transform","translate("+(n.width-70)+" "+(n.height-76)+") scale(0.75)"),i.setAttribute("class","svg-pan-zoom-control"),i.appendChild(this._createZoomIn(n)),i.appendChild(this._createZoomReset(n)),i.appendChild(this._createZoomOut(n)),n.svg.appendChild(i),n.controlIcons=i},_createZoomIn:function(n){var t=document.createElementNS(a.svgNS,"g");t.setAttribute("id","svg-pan-zoom-zoom-in"),t.setAttribute("transform","translate(30.5 5) scale(0.015)"),t.setAttribute("class","svg-pan-zoom-control"),t.addEventListener("click",function(){n.getPublicInstance().zoomIn()},!1),t.addEventListener("touchstart",function(){n.getPublicInstance().zoomIn()},!1);var e=document.createElementNS(a.svgNS,"rect");e.setAttribute("x","0"),e.setAttribute("y","0"),e.setAttribute("width","1500"),e.setAttribute("height","1400"),e.setAttribute("class","svg-pan-zoom-control-background"),t.appendChild(e);var o=document.createElementNS(a.svgNS,"path");return o.setAttribute("d","M1280 576v128q0 26 -19 45t-45 19h-320v320q0 26 -19 45t-45 19h-128q-26 0 -45 -19t-19 -45v-320h-320q-26 0 -45 -19t-19 -45v-128q0 -26 19 -45t45 -19h320v-320q0 -26 19 -45t45 -19h128q26 0 45 19t19 45v320h320q26 0 45 19t19 45zM1536 1120v-960 q0 -119 -84.5 -203.5t-203.5 -84.5h-960q-119 0 -203.5 84.5t-84.5 203.5v960q0 119 84.5 203.5t203.5 84.5h960q119 0 203.5 -84.5t84.5 -203.5z"),o.setAttribute("class","svg-pan-zoom-control-element"),t.appendChild(o),t},_createZoomReset:function(n){var t=document.createElementNS(a.svgNS,"g");t.setAttribute("id","svg-pan-zoom-reset-pan-zoom"),t.setAttribute("transform","translate(5 35) scale(0.4)"),t.setAttribute("class","svg-pan-zoom-control"),t.addEventListener("click",function(){n.getPublicInstance().reset()},!1),t.addEventListener("touchstart",function(){n.getPublicInstance().reset()},!1);var e=document.createElementNS(a.svgNS,"rect");e.setAttribute("x","2"),e.setAttribute("y","2"),e.setAttribute("width","182"),e.setAttribute("height","58"),e.setAttribute("class","svg-pan-zoom-control-background"),t.appendChild(e);var o=document.createElementNS(a.svgNS,"path");o.setAttribute("d","M33.051,20.632c-0.742-0.406-1.854-0.609-3.338-0.609h-7.969v9.281h7.769c1.543,0,2.701-0.188,3.473-0.562c1.365-0.656,2.048-1.953,2.048-3.891C35.032,22.757,34.372,21.351,33.051,20.632z"),o.setAttribute("class","svg-pan-zoom-control-element"),t.appendChild(o);var i=document.createElementNS(a.svgNS,"path");return i.setAttribute("d","M170.231,0.5H15.847C7.102,0.5,0.5,5.708,0.5,11.84v38.861C0.5,56.833,7.102,61.5,15.847,61.5h154.384c8.745,0,15.269-4.667,15.269-10.798V11.84C185.5,5.708,178.976,0.5,170.231,0.5z M42.837,48.569h-7.969c-0.219-0.766-0.375-1.383-0.469-1.852c-0.188-0.969-0.289-1.961-0.305-2.977l-0.047-3.211c-0.03-2.203-0.41-3.672-1.142-4.406c-0.732-0.734-2.103-1.102-4.113-1.102h-7.05v13.547h-7.055V14.022h16.524c2.361,0.047,4.178,0.344,5.45,0.891c1.272,0.547,2.351,1.352,3.234,2.414c0.731,0.875,1.31,1.844,1.737,2.906s0.64,2.273,0.64,3.633c0,1.641-0.414,3.254-1.242,4.84s-2.195,2.707-4.102,3.363c1.594,0.641,2.723,1.551,3.387,2.73s0.996,2.98,0.996,5.402v2.32c0,1.578,0.063,2.648,0.19,3.211c0.19,0.891,0.635,1.547,1.333,1.969V48.569z M75.579,48.569h-26.18V14.022h25.336v6.117H56.454v7.336h16.781v6H56.454v8.883h19.125V48.569z M104.497,46.331c-2.44,2.086-5.887,3.129-10.34,3.129c-4.548,0-8.125-1.027-10.731-3.082s-3.909-4.879-3.909-8.473h6.891c0.224,1.578,0.662,2.758,1.316,3.539c1.196,1.422,3.246,2.133,6.15,2.133c1.739,0,3.151-0.188,4.236-0.562c2.058-0.719,3.087-2.055,3.087-4.008c0-1.141-0.504-2.023-1.512-2.648c-1.008-0.609-2.607-1.148-4.796-1.617l-3.74-0.82c-3.676-0.812-6.201-1.695-7.576-2.648c-2.328-1.594-3.492-4.086-3.492-7.477c0-3.094,1.139-5.664,3.417-7.711s5.623-3.07,10.036-3.07c3.685,0,6.829,0.965,9.431,2.895c2.602,1.93,3.966,4.73,4.093,8.402h-6.938c-0.128-2.078-1.057-3.555-2.787-4.43c-1.154-0.578-2.587-0.867-4.301-0.867c-1.907,0-3.428,0.375-4.565,1.125c-1.138,0.75-1.706,1.797-1.706,3.141c0,1.234,0.561,2.156,1.682,2.766c0.721,0.406,2.25,0.883,4.589,1.43l6.063,1.43c2.657,0.625,4.648,1.461,5.975,2.508c2.059,1.625,3.089,3.977,3.089,7.055C108.157,41.624,106.937,44.245,104.497,46.331z M139.61,48.569h-26.18V14.022h25.336v6.117h-18.281v7.336h16.781v6h-16.781v8.883h19.125V48.569z M170.337,20.14h-10.336v28.43h-7.266V20.14h-10.383v-6.117h27.984V20.14z"),i.setAttribute("class","svg-pan-zoom-control-element"),t.appendChild(i),t},_createZoomOut:function(n){var t=document.createElementNS(a.svgNS,"g");t.setAttribute("id","svg-pan-zoom-zoom-out"),t.setAttribute("transform","translate(30.5 70) scale(0.015)"),t.setAttribute("class","svg-pan-zoom-control"),t.addEventListener("click",function(){n.getPublicInstance().zoomOut()},!1),t.addEventListener("touchstart",function(){n.getPublicInstance().zoomOut()},!1);var e=document.createElementNS(a.svgNS,"rect");e.setAttribute("x","0"),e.setAttribute("y","0"),e.setAttribute("width","1500"),e.setAttribute("height","1400"),e.setAttribute("class","svg-pan-zoom-control-background"),t.appendChild(e);var o=document.createElementNS(a.svgNS,"path");return o.setAttribute("d","M1280 576v128q0 26 -19 45t-45 19h-896q-26 0 -45 -19t-19 -45v-128q0 -26 19 -45t45 -19h896q26 0 45 19t19 45zM1536 1120v-960q0 -119 -84.5 -203.5t-203.5 -84.5h-960q-119 0 -203.5 84.5t-84.5 203.5v960q0 119 84.5 203.5t203.5 84.5h960q119 0 203.5 -84.5 t84.5 -203.5z"),o.setAttribute("class","svg-pan-zoom-control-element"),t.appendChild(o),t},disable:function(e){e.controlIcons&&(e.controlIcons.parentNode.removeChild(e.controlIcons),e.controlIcons=null)}}},{"./svg-utilities":5}],3:[function(o,t){var e=o("./svg-utilities"),a=o("./utilities"),n=function(o,t){this.init(o,t)};n.prototype.init=function(n,t){this.viewport=n,this.options=t,this.originalState={zoom:1,x:0,y:0},this.activeState={zoom:1,x:0,y:0},this.updateCTMCached=a.proxy(this.updateCTM,this),this.requestAnimationFrame=a.createRequestAnimationFrame(this.options.refreshRate),this.viewBox={x:0,y:0,width:0,height:0},this.cacheViewBox();var e=this.processCTM();this.setCTM(e),this.updateCTM()},n.prototype.cacheViewBox=function(){var n=this.options.svg.getAttribute("viewBox");if(n){var t=n.split(/[\s\,]/).filter(function(e){return e}).map(parseFloat);this.viewBox.x=t[0],this.viewBox.y=t[1],this.viewBox.width=t[2],this.viewBox.height=t[3];var e=p(this.options.width/this.viewBox.width,this.options.height/this.viewBox.height);this.activeState.zoom=e,this.activeState.x=(this.options.width-this.viewBox.width*e)/2,this.activeState.y=(this.options.height-this.viewBox.height*e)/2,this.updateCTMOnNextFrame(),this.options.svg.removeAttribute("viewBox")}else this.simpleViewBoxCache()},n.prototype.simpleViewBoxCache=function(){var e=this.viewport.getBBox();this.viewBox.x=e.x,this.viewBox.y=e.y,this.viewBox.width=e.width,this.viewBox.height=e.height},n.prototype.getViewBox=function(){return a.extend({},this.viewBox)},n.prototype.processCTM=function(){var i=this.getCTM();if(this.options.fit||this.options.contain){var t;t=this.options.fit?p(this.options.width/this.viewBox.width,this.options.height/this.viewBox.height):d(this.options.width/this.viewBox.width,this.options.height/this.viewBox.height),i.a=t,i.d=t,i.e=-this.viewBox.x*t,i.f=-this.viewBox.y*t}if(this.options.center){var s=.5*(this.options.width-(this.viewBox.width+2*this.viewBox.x)*i.a),o=.5*(this.options.height-(this.viewBox.height+2*this.viewBox.y)*i.a);i.e=s,i.f=o}return this.originalState.zoom=i.a,this.originalState.x=i.e,this.originalState.y=i.f,i},n.prototype.getOriginalState=function(){return a.extend({},this.originalState)},n.prototype.getState=function(){return a.extend({},this.activeState)},n.prototype.getZoom=function(){return this.activeState.zoom},n.prototype.getRelativeZoom=function(){return this.activeState.zoom/this.originalState.zoom},n.prototype.computeRelativeZoom=function(e){return e/this.originalState.zoom},n.prototype.getPan=function(){return{x:this.activeState.x,y:this.activeState.y}},n.prototype.getCTM=function(){var e=this.options.svg.createSVGMatrix();return e.a=this.activeState.zoom,e.b=0,e.c=0,e.d=this.activeState.zoom,e.e=this.activeState.x,e.f=this.activeState.y,e},n.prototype.setCTM=function(i){var t=this.isZoomDifferent(i),l=this.isPanDifferent(i);if(t||l){if(t&&(!1===this.options.beforeZoom(this.getRelativeZoom(),this.computeRelativeZoom(i.a))?(i.a=i.d=this.activeState.zoom,t=!1):(this.updateCache(i),this.options.onZoom(this.getRelativeZoom()))),l){var d=this.options.beforePan(this.getPan(),{x:i.e,y:i.f}),n=!1,p=!1;!1===d?(i.e=this.getPan().x,i.f=this.getPan().y,n=p=!0):a.isObject(d)&&(!1===d.x?(i.e=this.getPan().x,n=!0):a.isNumber(d.x)&&(i.e=d.x),!1===d.y?(i.f=this.getPan().y,p=!0):a.isNumber(d.y)&&(i.f=d.y)),n&&p||!this.isPanDifferent(i)?l=!1:(this.updateCache(i),this.options.onPan(this.getPan()))}(t||l)&&this.updateCTMOnNextFrame()}},n.prototype.isZoomDifferent=function(e){return this.activeState.zoom!==e.a},n.prototype.isPanDifferent=function(e){return this.activeState.x!==e.e||this.activeState.y!==e.f},n.prototype.updateCache=function(e){this.activeState.zoom=e.a,this.activeState.x=e.e,this.activeState.y=e.f},n.prototype.pendingUpdate=!1,n.prototype.updateCTMOnNextFrame=function(){this.pendingUpdate||(this.pendingUpdate=!0,this.requestAnimationFrame.call(window,this.updateCTMCached))},n.prototype.updateCTM=function(){var o=this.getCTM();e.setCTM(this.viewport,o,this.defs),this.pendingUpdate=!1,this.options.onUpdatedCTM&&this.options.onUpdatedCTM(o)},t.exports=function(o,t){return new n(o,t)}},{"./svg-utilities":5,"./utilities":7}],4:[function(o,t){var g=o("./uniwheel"),m=o("./control-icons"),i=o("./utilities"),v=o("./svg-utilities"),s=o("./shadow-viewport"),a=function(o,t){this.init(o,t)},r={viewportSelector:".svg-pan-zoom_viewport",panEnabled:!0,controlIconsEnabled:!1,zoomEnabled:!0,dblClickZoomEnabled:!0,mouseWheelZoomEnabled:!0,preventMouseEventsDefault:!0,zoomScaleSensitivity:.1,minZoom:.5,maxZoom:10,fit:!0,contain:!1,center:!0,refreshRate:"auto",beforeZoom:null,onZoom:null,beforePan:null,onPan:null,customEventsHandler:null,eventsListenerElement:null,onUpdatedCTM:null},n={passive:!0};a.prototype.init=function(a,t){var d=this;this.svg=a,this.defs=a.querySelector("defs"),v.setupSvgAttributes(this.svg),this.options=i.extend(i.extend({},r),t),this.state="none";var e=v.getBoundingClientRectNormalized(a);this.width=e.width,this.height=e.height,this.viewport=s(v.getOrCreateViewport(this.svg,this.options.viewportSelector),{svg:this.svg,width:this.width,height:this.height,fit:this.options.fit,contain:this.options.contain,center:this.options.center,refreshRate:this.options.refreshRate,beforeZoom:function(o,t){if(d.viewport&&d.options.beforeZoom)return d.options.beforeZoom(o,t)},onZoom:function(e){if(d.viewport&&d.options.onZoom)return d.options.onZoom(e)},beforePan:function(o,t){if(d.viewport&&d.options.beforePan)return d.options.beforePan(o,t)},onPan:function(e){if(d.viewport&&d.options.onPan)return d.options.onPan(e)},onUpdatedCTM:function(e){if(d.viewport&&d.options.onUpdatedCTM)return d.options.onUpdatedCTM(e)}});var o=this.getPublicInstance();o.setBeforeZoom(this.options.beforeZoom),o.setOnZoom(this.options.onZoom),o.setBeforePan(this.options.beforePan),o.setOnPan(this.options.onPan),o.setOnUpdatedCTM(this.options.onUpdatedCTM),this.options.controlIconsEnabled&&m.enable(this),this.lastMouseWheelEventTime=Date.now(),this.setupHandlers()},a.prototype.setupHandlers=function(){var s=this,t=null;if(this.eventListeners={mousedown:function(e){var o=s.handleMouseDown(e,t);return t=e,o},touchstart:function(e){var o=s.handleMouseDown(e,t);return t=e,o},mouseup:function(t){return s.handleMouseUp(t)},touchend:function(t){return s.handleMouseUp(t)},mousemove:function(t){return s.handleMouseMove(t)},touchmove:function(t){return s.handleMouseMove(t)},mouseleave:function(t){return s.handleMouseUp(t)},touchleave:function(t){return s.handleMouseUp(t)},touchcancel:function(t){return s.handleMouseUp(t)}},null!=this.options.customEventsHandler){this.options.customEventsHandler.init({svgElement:this.svg,eventsListenerElement:this.options.eventsListenerElement,instance:this.getPublicInstance()});var a=this.options.customEventsHandler.haltEventListeners;if(a&&a.length)for(var o=a.length-1;0<=o;o--)this.eventListeners.hasOwnProperty(a[o])&&delete this.eventListeners[a[o]]}for(var r in this.eventListeners)(this.options.eventsListenerElement||this.svg).addEventListener(r,this.eventListeners[r],!this.options.preventMouseEventsDefault&&n);this.options.mouseWheelZoomEnabled&&(this.options.mouseWheelZoomEnabled=!1,this.enableMouseWheelZoom())},a.prototype.enableMouseWheelZoom=function(){if(!this.options.mouseWheelZoomEnabled){var o=this;this.wheelListener=function(t){return o.handleMouseWheel(t)};var t=!this.options.preventMouseEventsDefault;g.on(this.options.eventsListenerElement||this.svg,this.wheelListener,t),this.options.mouseWheelZoomEnabled=!0}},a.prototype.disableMouseWheelZoom=function(){if(this.options.mouseWheelZoomEnabled){var e=!this.options.preventMouseEventsDefault;g.off(this.options.eventsListenerElement||this.svg,this.wheelListener,e),this.options.mouseWheelZoomEnabled=!1}},a.prototype.handleMouseWheel=function(r){var t=Math.log,p=Math.abs;if(this.options.zoomEnabled&&"none"===this.state){this.options.preventMouseEventsDefault&&(r.preventDefault?r.preventDefault():r.returnValue=!1);var c=r.deltaY||1,u=Date.now()-this.lastMouseWheelEventTime,o=3+d(0,30-u);this.lastMouseWheelEventTime=Date.now(),"deltaMode"in r&&0===r.deltaMode&&r.wheelDelta&&(c=0===r.deltaY?0:p(r.wheelDelta)/r.deltaY),c=-.3<c&&.3>c?c:(0<c?1:-1)*t(p(c)+10)/o;var n=this.svg.getScreenCTM().inverse(),i=v.getEventPoint(r,this.svg).matrixTransform(n),s=l(1+this.options.zoomScaleSensitivity,-1*c);this.zoomAtPoint(s,i)}},a.prototype.zoomAtPoint=function(l,c,e){var o=this.viewport.getOriginalState();e?(l=d(this.options.minZoom*o.zoom,p(this.options.maxZoom*o.zoom,l)),l/=this.getZoom()):this.getZoom()*l<this.options.minZoom*o.zoom?l=this.options.minZoom*o.zoom/this.getZoom():this.getZoom()*l>this.options.maxZoom*o.zoom&&(l=this.options.maxZoom*o.zoom/this.getZoom());var n=this.viewport.getCTM(),i=c.matrixTransform(n.inverse()),s=this.svg.createSVGMatrix().translate(i.x,i.y).scale(l).translate(-i.x,-i.y),r=n.multiply(s);r.a!==n.a&&this.viewport.setCTM(r)},a.prototype.zoom=function(o,t){this.zoomAtPoint(o,v.getSvgCenterPoint(this.svg,this.width,this.height),t)},a.prototype.publicZoom=function(o,n){n&&(o=this.computeFromRelativeZoom(o)),this.zoom(o,n)},a.prototype.publicZoomAtPoint=function(n,s,a){if(a&&(n=this.computeFromRelativeZoom(n)),"SVGPoint"!==i.getType(s)){if(!("x"in s&&"y"in s))throw new Error("Given point is invalid");s=v.createSVGPoint(this.svg,s.x,s.y)}this.zoomAtPoint(n,s,a)},a.prototype.getZoom=function(){return this.viewport.getZoom()},a.prototype.getRelativeZoom=function(){return this.viewport.getRelativeZoom()},a.prototype.computeFromRelativeZoom=function(e){return e*this.viewport.getOriginalState().zoom},a.prototype.resetZoom=function(){var e=this.viewport.getOriginalState();this.zoom(e.zoom,!0)},a.prototype.resetPan=function(){this.pan(this.viewport.getOriginalState())},a.prototype.reset=function(){this.resetZoom(),this.resetPan()},a.prototype.handleDblClick=function(i){if(this.options.preventMouseEventsDefault&&(i.preventDefault?i.preventDefault():i.returnValue=!1),this.options.controlIconsEnabled){var t=i.target.getAttribute("class")||"";if(-1<t.indexOf("svg-pan-zoom-control"))return!1}var e=i.shiftKey?1/(2*(1+this.options.zoomScaleSensitivity)):2*(1+this.options.zoomScaleSensitivity);var o=v.getEventPoint(i,this.svg).matrixTransform(this.svg.getScreenCTM().inverse());this.zoomAtPoint(e,o)},a.prototype.handleMouseDown=function(o,t){this.options.preventMouseEventsDefault&&(o.preventDefault?o.preventDefault():o.returnValue=!1),i.mouseAndTouchNormalize(o,this.svg),this.options.dblClickZoomEnabled&&i.isDblClick(o,t)?this.handleDblClick(o):(this.state="pan",this.firstEventCTM=this.viewport.getCTM(),this.stateOrigin=v.getEventPoint(o,this.svg).matrixTransform(this.firstEventCTM.inverse()))},a.prototype.handleMouseMove=function(n){if(this.options.preventMouseEventsDefault&&(n.preventDefault?n.preventDefault():n.returnValue=!1),"pan"===this.state&&this.options.panEnabled){var t=v.getEventPoint(n,this.svg).matrixTransform(this.firstEventCTM.inverse()),e=this.firstEventCTM.translate(t.x-this.stateOrigin.x,t.y-this.stateOrigin.y);this.viewport.setCTM(e)}},a.prototype.handleMouseUp=function(e){this.options.preventMouseEventsDefault&&(e.preventDefault?e.preventDefault():e.returnValue=!1),"pan"===this.state&&(this.state="none")},a.prototype.fit=function(){var o=this.viewport.getViewBox(),t=p(this.width/o.width,this.height/o.height);this.zoom(t,!0)},a.prototype.contain=function(){var o=this.viewport.getViewBox(),t=d(this.width/o.width,this.height/o.height);this.zoom(t,!0)},a.prototype.center=function(){var n=this.viewport.getViewBox(),t=.5*(this.width-(n.width+2*n.x)*this.getZoom()),e=.5*(this.height-(n.height+2*n.y)*this.getZoom());this.getPublicInstance().pan({x:t,y:e})},a.prototype.updateBBox=function(){this.viewport.simpleViewBoxCache()},a.prototype.pan=function(o){var t=this.viewport.getCTM();t.e=o.x,t.f=o.y,this.viewport.setCTM(t)},a.prototype.panBy=function(o){var t=this.viewport.getCTM();t.e+=o.x,t.f+=o.y,this.viewport.setCTM(t)},a.prototype.getPan=function(){var e=this.viewport.getState();return{x:e.x,y:e.y}},a.prototype.resize=function(){var o=v.getBoundingClientRectNormalized(this.svg);this.width=o.width,this.height=o.height;var t=this.viewport;t.options.width=this.width,t.options.height=this.height,t.processCTM(),this.options.controlIconsEnabled&&(this.getPublicInstance().disableControlIcons(),this.getPublicInstance().enableControlIcons())},a.prototype.destroy=function(){var o=this;for(var t in this.beforeZoom=null,this.onZoom=null,this.beforePan=null,this.onPan=null,this.onUpdatedCTM=null,null!=this.options.customEventsHandler&&this.options.customEventsHandler.destroy({svgElement:this.svg,eventsListenerElement:this.options.eventsListenerElement,instance:this.getPublicInstance()}),this.eventListeners)(this.options.eventsListenerElement||this.svg).removeEventListener(t,this.eventListeners[t],!this.options.preventMouseEventsDefault&&n);this.disableMouseWheelZoom(),this.getPublicInstance().disableControlIcons(),this.reset(),u=u.filter(function(t){return t.svg!==o.svg}),delete this.options,delete this.viewport,delete this.publicInstance,delete this.pi,this.getPublicInstance=function(){return null}},a.prototype.getPublicInstance=function(){var n=this;return this.publicInstance||(this.publicInstance=this.pi={enablePan:function(){return n.options.panEnabled=!0,n.pi},disablePan:function(){return n.options.panEnabled=!1,n.pi},isPanEnabled:function(){return!!n.options.panEnabled},pan:function(t){return n.pan(t),n.pi},panBy:function(t){return n.panBy(t),n.pi},getPan:function(){return n.getPan()},setBeforePan:function(t){return n.options.beforePan=null===t?null:i.proxy(t,n.publicInstance),n.pi},setOnPan:function(t){return n.options.onPan=null===t?null:i.proxy(t,n.publicInstance),n.pi},enableZoom:function(){return n.options.zoomEnabled=!0,n.pi},disableZoom:function(){return n.options.zoomEnabled=!1,n.pi},isZoomEnabled:function(){return!!n.options.zoomEnabled},enableControlIcons:function(){return n.options.controlIconsEnabled||(n.options.controlIconsEnabled=!0,m.enable(n)),n.pi},disableControlIcons:function(){return n.options.controlIconsEnabled&&(n.options.controlIconsEnabled=!1,m.disable(n)),n.pi},isControlIconsEnabled:function(){return!!n.options.controlIconsEnabled},enableDblClickZoom:function(){return n.options.dblClickZoomEnabled=!0,n.pi},disableDblClickZoom:function(){return n.options.dblClickZoomEnabled=!1,n.pi},isDblClickZoomEnabled:function(){return!!n.options.dblClickZoomEnabled},enableMouseWheelZoom:function(){return n.enableMouseWheelZoom(),n.pi},disableMouseWheelZoom:function(){return n.disableMouseWheelZoom(),n.pi},isMouseWheelZoomEnabled:function(){return!!n.options.mouseWheelZoomEnabled},setZoomScaleSensitivity:function(t){return n.options.zoomScaleSensitivity=t,n.pi},setMinZoom:function(t){return n.options.minZoom=t,n.pi},setMaxZoom:function(t){return n.options.maxZoom=t,n.pi},setBeforeZoom:function(t){return n.options.beforeZoom=null===t?null:i.proxy(t,n.publicInstance),n.pi},setOnZoom:function(t){return n.options.onZoom=null===t?null:i.proxy(t,n.publicInstance),n.pi},zoom:function(t){return n.publicZoom(t,!0),n.pi},zoomBy:function(t){return n.publicZoom(t,!1),n.pi},zoomAtPoint:function(t,e){return n.publicZoomAtPoint(t,e,!0),n.pi},zoomAtPointBy:function(t,e){return n.publicZoomAtPoint(t,e,!1),n.pi},zoomIn:function(){return this.zoomBy(1+n.options.zoomScaleSensitivity),n.pi},zoomOut:function(){return this.zoomBy(1/(1+n.options.zoomScaleSensitivity)),n.pi},getZoom:function(){return n.getRelativeZoom()},setOnUpdatedCTM:function(t){return n.options.onUpdatedCTM=null===t?null:i.proxy(t,n.publicInstance),n.pi},resetZoom:function(){return n.resetZoom(),n.pi},resetPan:function(){return n.resetPan(),n.pi},reset:function(){return n.reset(),n.pi},fit:function(){return n.fit(),n.pi},contain:function(){return n.contain(),n.pi},center:function(){return n.center(),n.pi},updateBBox:function(){return n.updateBBox(),n.pi},resize:function(){return n.resize(),n.pi},getSizes:function(){return{width:n.width,height:n.height,realZoom:n.getZoom(),viewBox:n.viewport.getViewBox()}},destroy:function(){return n.destroy(),n.pi}}),this.publicInstance};var u=[],e=function(s,t){var e=i.getSvg(s);if(null===e)return null;for(var o=u.length-1;0<=o;o--)if(u[o].svg===e)return u[o].instance.getPublicInstance();return u.push({svg:e,instance:new a(e,t)}),u[u.length-1].instance.getPublicInstance()};t.exports=e},{"./control-icons":2,"./shadow-viewport":3,"./svg-utilities":5,"./uniwheel":6,"./utilities":7}],5:[function(o,t){var d=o("./utilities"),a="unknown";document.documentMode&&(a="ie"),t.exports={svgNS:"http://www.w3.org/2000/svg",xmlNS:"http://www.w3.org/XML/1998/namespace",xmlnsNS:"http://www.w3.org/2000/xmlns/",xlinkNS:"http://www.w3.org/1999/xlink",evNS:"http://www.w3.org/2001/xml-events",getBoundingClientRectNormalized:function(e){if(e.clientWidth&&e.clientHeight)return{width:e.clientWidth,height:e.clientHeight};if(e.getBoundingClientRect())return e.getBoundingClientRect();throw new Error("Cannot get BoundingClientRect for SVG.")},getOrCreateViewport:function(n,t){var e=null;if(e=d.isElement(t)?t:n.querySelector(t),!e){var p=Array.prototype.slice.call(n.childNodes||n.children).filter(function(e){return"defs"!==e.nodeName&&"#text"!==e.nodeName});1===p.length&&"g"===p[0].nodeName&&null===p[0].getAttribute("transform")&&(e=p[0])}if(!e){var i="viewport-"+new Date().toISOString().replace(/\D/g,"");e=document.createElementNS(this.svgNS,"g"),e.setAttribute("id",i);var s=n.childNodes||n.children;if(s&&0<s.length)for(var r=s.length;0<r;r--)"defs"!==s[s.length-r].nodeName&&e.appendChild(s[s.length-r]);n.appendChild(e)}var c=[];return e.getAttribute("class")&&(c=e.getAttribute("class").split(" ")),~c.indexOf("svg-pan-zoom_viewport")||(c.push("svg-pan-zoom_viewport"),e.setAttribute("class",c.join(" "))),e},setupSvgAttributes:function(o){if(o.setAttribute("xmlns",this.svgNS),o.setAttributeNS(this.xmlnsNS,"xmlns:xlink",this.xlinkNS),o.setAttributeNS(this.xmlnsNS,"xmlns:ev",this.evNS),null!==o.parentNode){var t=o.getAttribute("style")||"";-1===t.toLowerCase().indexOf("overflow")&&o.setAttribute("style","overflow: hidden; "+t)}},internetExplorerRedisplayInterval:300,refreshDefsGlobal:d.throttle(function(){for(var i,s=document.querySelectorAll("defs"),t=s.length,e=0;e<t;e++)i=s[e],i.parentNode.insertBefore(i,i)},this?this.internetExplorerRedisplayInterval:null),setCTM:function(i,t,e){var o=this,n="matrix("+t.a+","+t.b+","+t.c+","+t.d+","+t.e+","+t.f+")";i.setAttributeNS(null,"transform",n),"transform"in i.style?i.style.transform=n:"-ms-transform"in i.style?i.style["-ms-transform"]=n:"-webkit-transform"in i.style&&(i.style["-webkit-transform"]=n),"ie"==a&&e&&(e.parentNode.insertBefore(e,e),window.setTimeout(function(){o.refreshDefsGlobal()},o.internetExplorerRedisplayInterval))},getEventPoint:function(n,t){var e=t.createSVGPoint();return d.mouseAndTouchNormalize(n,t),e.x=n.clientX,e.y=n.clientY,e},getSvgCenterPoint:function(n,t,e){return this.createSVGPoint(n,t/2,e/2)},createSVGPoint:function(i,t,e){var o=i.createSVGPoint();return o.x=t,o.y=e,o}}},{"./utilities":7}],6:[function(o,t){t.exports=function(){function d(n,s){var e=function(e){e||(e=window.event);var n={originalEvent:e,target:e.target||e.srcElement,type:"wheel",deltaMode:"MozMousePixelScroll"==e.type?0:1,deltaX:0,delatZ:0,preventDefault:function(){e.preventDefault?e.preventDefault():e.returnValue=!1}};return"mousewheel"==f?(n.deltaY=-.025*e.wheelDelta,e.wheelDeltaX&&(n.deltaX=-.025*e.wheelDeltaX)):n.deltaY=e.detail,s(n)};return i.push({element:n,fn:e}),e}function g(o){for(var t=0;t<i.length;t++)if(i[t].element===o)return i[t].fn;return function(){}}function e(o){for(var t=0;t<i.length;t++)if(i[t].element===o)return i.splice(t,1)}function m(t,e,o,n){var i;i="wheel"===f?o:d(t,o),t[r](b+e,i,!!n&&c)}function n(o,t,n,i){var s;s="wheel"===f?n:g(o),o[v](b+t,s,!!i&&c),e(o)}function t(n,t,e){m(n,f,t,e),"DOMMouseScroll"==f&&m(n,"MozMousePixelScroll",t,e)}function o(i,t,e){n(i,f,t,e),"DOMMouseScroll"==f&&n(i,"MozMousePixelScroll",t,e)}var r,v,f,b="",i=[],c={passive:!0};return window.addEventListener?(r="addEventListener",v="removeEventListener"):(r="attachEvent",v="detachEvent",b="on"),f="onwheel"in document.createElement("div")?"wheel":void 0===document.onmousewheel?"DOMMouseScroll":"mousewheel",{on:t,off:o}}()},{}],7:[function(o,t){function i(o){return function(t){window.setTimeout(t,o)}}t.exports={extend:function(n,i){for(var e in n=n||{},i)n[e]=this.isObject(i[e])?this.extend(n[e],i[e]):i[e];return n},isElement:function(e){return e instanceof HTMLElement||e instanceof SVGElement||e instanceof SVGSVGElement||e&&"object"==typeof e&&null!==e&&1===e.nodeType&&"string"==typeof e.nodeName},isObject:function(e){return"[object Object]"===Object.prototype.toString.call(e)},isNumber:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},getSvg:function(n){var t,i;if(this.isElement(n))t=n;else{if(!("string"==typeof n||n instanceof String))throw new Error("Provided selector is not an HTML object nor String");if(t=document.querySelector(n),!t)throw new Error("Provided selector did not find any elements. Selector: "+n)}if("svg"===t.tagName.toLowerCase())i=t;else if("object"===t.tagName.toLowerCase())i=t.contentDocument.documentElement;else{if("embed"!==t.tagName.toLowerCase())throw"img"===t.tagName.toLowerCase()?new Error("Cannot script an SVG in an \"img\" element. Please use an \"object\" element or an in-line SVG."):new Error("Cannot get SVG.");i=t.getSVGDocument().documentElement}return i},proxy:function(o,t){return function(){return o.apply(t,arguments)}},getType:function(e){return Object.prototype.toString.apply(e).replace(/^\[object\s/,"").replace(/\]$/,"")},mouseAndTouchNormalize:function(n,t){if(void 0===n.clientX||null===n.clientX)if(n.clientX=0,n.clientY=0,!(void 0!==n.touches&&n.touches.length))void 0!==n.originalEvent&&void 0!==n.originalEvent.clientX&&(n.clientX=n.originalEvent.clientX,n.clientY=n.originalEvent.clientY);else if(void 0!==n.touches[0].clientX)n.clientX=n.touches[0].clientX,n.clientY=n.touches[0].clientY;else if(void 0!==n.touches[0].pageX){var e=t.getBoundingClientRect();n.clientX=n.touches[0].pageX-e.left,n.clientY=n.touches[0].pageY-e.top}},isDblClick:function(i,t){var e=Math.sqrt;if(2===i.detail)return!0;if(void 0!==t&&null!==t){var s=i.timeStamp-t.timeStamp,o=e(l(i.clientX-t.clientX,2)+l(i.clientY-t.clientY,2));return 250>s&&10>o}return!1},now:Date.now||function(){return new Date().getTime()},throttle:function(d,t,e){var p,g,m,v=this,r=null,f=0;e||(e={});var b=function(){f=!1===e.leading?0:v.now(),r=null,m=d.apply(p,g),r||(p=g=null)};return function(){var o=v.now();f||!1!==e.leading||(f=o);var n=t-(o-f);return p=this,g=arguments,0>=n||n>t?(clearTimeout(r),r=null,f=o,m=d.apply(p,g),r||(p=g=null)):r||!1===e.trailing||(r=setTimeout(b,n)),m}},createRequestAnimationFrame:function(o){var t=Math.floor,n=null;return"auto"!==o&&60>o&&1<o&&(n=t(1e3/o)),null===n?window.requestAnimationFrame||i(33):i(n)}}},{}]},{},[1]);class x{constructor(e){this.type=e,this.init()}init(){this.elem=document.createElement("div"),this.arrow=document.createElement("div"),this.content=document.createElement("div"),i(this.arrow,{position:"absolute",width:"0px",height:"0px",borderWidth:"3px",borderColor:"transparent",borderStyle:"solid",borderBottomWidth:"0px",borderTopColor:"#3d3d3d",bottom:"-3px",left:"-3px"}),i(this.content,{backgroundColor:"#3d3d3d",color:"#fff",height:"24px",whiteSpace:"nowrap",lineHeight:"24px",transform:"translateX(-50%)",padding:"0 10px",borderRadius:"4px"}),this.elem.appendChild(this.arrow),this.elem.appendChild(this.content)}show({left:e,top:t,text:o,dx:n}){n=n||0;const{type:s}=this;let a="node"===s?`translate(${n}px, -100%)`:"translateY(-100%)";i(this.elem,{position:"fixed",zIndex:1500,left:e+"px",top:t-8+"px",transform:a}),this.content.innerHTML=o,document.body.appendChild(this.elem)}hide(){document.body.removeChild(this.elem)}}const y={zoomIn:`<svg t="1546354735657" class="icon" style="" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3865" xmlns:xlink="http://www.w3.org/1999/xlink" width="20" height="20">
    <defs><style type="text/css"></style></defs>
    <path d="M919.264 905.984l-138.912-138.912C851.808 692.32 896 591.328 896 480c0-229.376-186.624-416-416-416S64 250.624 64 480s186.624 416 416 416c95.008 0 182.432-32.384 252.544-86.208l141.44 141.44a31.904 31.904 0 0 0 45.248 0 32 32 0 0 0 0.032-45.248zM128 480C128 285.92 285.92 128 480 128s352 157.92 352 352-157.92 352-352 352S128 674.08 128 480z" p-id="3866"></path><path d="M625.792 448H512v-112a32 32 0 0 0-64 0V448h-112a32 32 0 0 0 0 64H448v112a32 32 0 1 0 64 0V512h113.792a32 32 0 1 0 0-64z" p-id="3867"></path>
    </svg>`,zoomOut:`<svg t="1546355535455" class="icon" style="" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4099" xmlns:xlink="http://www.w3.org/1999/xlink" width="20" height="20">
    <defs><style type="text/css"></style></defs
    ><path d="M480 896C250.624 896 64 709.376 64 480S250.624 64 480 64s416 186.624 416 416-186.624 416-416 416z m0-768C285.92 128 128 285.92 128 480s157.92 352 352 352 352-157.92 352-352S674.08 128 480 128z" p-id="4100"></path><path d="M640 520H320a32 32 0 0 1 0-64h320a32 32 0 1 1 0 64zM896.64 960.64a31.904 31.904 0 0 1-22.624-9.376l-160.64-160.64a31.968 31.968 0 1 1 45.248-45.248l160.64 160.64a31.968 31.968 0 0 1-22.624 54.624z" p-id="4101"></path>
    </svg>`,resetZoom:`<svg t="1546355720537" class="icon" style="" viewBox="0 0 1228 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1280" xmlns:xlink="http://www.w3.org/1999/xlink" width="20" height="20">
    <defs><style type="text/css"></style></defs>
    <path d="M843.1616 68.266667H989.866667a170.666667 170.666667 0 0 1 170.666666 170.666666v152.8832a34.133333 34.133333 0 1 0 68.266667 0V238.933333a238.933333 238.933333 0 0 0-238.933333-238.933333h-146.705067a34.133333 34.133333 0 0 0 0 68.266667zM1160.533333 629.3504V785.066667a170.666667 170.666667 0 0 1-170.666666 170.666666h-123.5968a34.133333 34.133333 0 0 0 0 68.266667H989.866667a238.933333 238.933333 0 0 0 238.933333-238.933333v-155.716267a34.133333 34.133333 0 1 0-68.266667 0zM393.4208 955.733333H238.933333a170.666667 170.666667 0 0 1-170.666666-170.666666v-155.136a34.133333 34.133333 0 0 0-68.266667 0V785.066667a238.933333 238.933333 0 0 0 238.933333 238.933333h154.487467a34.133333 34.133333 0 0 0 0-68.266667zM68.266667 393.045333V238.933333a170.666667 170.666667 0 0 1 170.666666-170.666666h147.933867a34.133333 34.133333 0 0 0 0-68.266667H238.933333a238.933333 238.933333 0 0 0-238.933333 238.933333v154.112a34.133333 34.133333 0 1 0 68.266667 0z" p-id="1281"></path>
    </svg>`};class C{constructor(e){this.panZoomTiger=e,this.createCSSText()}createCSSText(){const e=document.createElement("style");e.innerHTML=`
            .graph_toolbox {
                font-size: 12px;
                margin: 0;
                transform: translateY(-100%);
                padding: 10px;
            }
            .graph_toolbox .tooltip {
                display: flex;
                width: 100%;
                align-item: center;
                justify-content: center;
            }
            .graph_toolbox .btn {
                display: flex;
                align-items: center;
                line-height: 32px;
                position: relative;
                z-index: 10;
                width: 32px;
                height: 32px;
                cursor: pointer;
                text-align: center;
                color: #fff;
                border: 1px solid #dedede;
                background: #fff;
                margin-bottom: 4px;
            }
        `,document.head.appendChild(e)}create(e){const t=document.querySelector(e),o=document.createElement("ul"),n=document.createElement("li"),i=document.createElement("li"),s=document.createElement("li");let a=t.getBoundingClientRect();return Object.assign(o.style,{position:"fixed",left:a.left+"px",top:a.bottom+"px",transform:"translateY()"}),this.build(n,"zoomIn"),this.build(i,"zoomOut"),this.build(s,"resetZoom"),o.className="graph_toolbox",n.className="btn graph_zoomInBtn",i.className="btn graph_zoomOutBtn",s.className="btn graph_resetBtn",o.appendChild(n),o.appendChild(i),o.appendChild(s),this.toolBox=o,this.zoomInBtn=n,this.zoomOutBtn=i,this.resetBtn=s,o}build(e,t){let o=document.createElement("span");o.innerHTML=y[t],o.className="tooltip";const n=new x("node");let i="";i="zoomIn"===t?"\u653E\u5927":"zoomOut"===t?"\u7F29\u5C0F":"resetZoom"===t?"\u539F\u59CB\u5927\u5C0F":"\u653E\u5927",e.addEventListener("click",()=>{this.panZoomTiger[t]()}),e.addEventListener("mouseenter",()=>{let t=e.getBoundingClientRect();n.show({left:t.left,top:t.top,text:i,dx:15})}),e.addEventListener("mouseleave",()=>{n.hide()}),e.appendChild(o)}}class S{constructor({matrix:e,initOptions:t}){this.matrix=e,this.initOptions=t,S.layoutNodeMap={},this.layoutMatrix=[],this.init()}init(){let{width:t,height:n,el:s,backgroundColor:a}=this.initOptions;this.svgCanvas=e("svg"),o(this.svgCanvas,{width:t,height:n,id:"viewport"}),i(this.svgCanvas,{backgroundColor:a});let r=this.createSymbols();r.forEach(e=>{this.svgCanvas.appendChild(e)}),this.linksWraper=e("g"),this.rootElement=document.querySelector(s)}build({rowConfig:e,columnConfig:t,node:o}){const{matrix:n,layoutMatrix:s}=this,{gap:a,height:r}=e,{gap:l}=t;let d=0;for(let p=0;p<n.length;p++){let e=n[p],t=[],i=d,c=0;for(let n=0;n<e.length;n++){let s=e[n],a=this.buildNode(s,{i:p,j:n,rowTop:i,currentLeft:c,columnGap:l,node:o}),r=a.layoutNode;c=a.currentLeft,S.layoutNodeMap[s.id]=r,t.push(r)}this.setRowContentCenter(t,c-l),d+=r+a,s.push(t)}this.layoutMatrix=s}buildNode(e,{i:t,j:o,rowTop:n,currentLeft:i,columnGap:s,node:a}){let r=i,l=e.setLayoutNode(new b(e,{rowIndex:t,columnIndex:o,top:n,left:r},a));return i+=l.getWidth()+s,{layoutNode:l,currentLeft:i}}setRowContentCenter(e,t){const{rootElement:o}=this,{width:n}=this.initOptions;let i=/%/,s=+n;i.test(n)&&(s=o.offsetWidth*(n.slice(0,-1)/100));let a=s/2-t/2;e.forEach(e=>{e.addLeft(a)})}createSymbols(){return v.map(e=>e.create())}renderNodes(){const{layoutMatrix:e,rootElement:t,linksWraper:o}=this;for(let t,o=0;o<e.length;o++){t=e[o];for(let e,o=0;o<t.length;o++)e=t[o],this.renderNodeLinks(e),this.svgCanvas.appendChild(e.createElement())}this.svgCanvas.appendChild(o),t.innerHTML=this.svgCanvas.outerHTML}renderNodeLinks(e){let{linksWraper:t}=this;const{source:o}=e.graphNode.links;o.forEach(e=>{let o=new w(e);t.appendChild(o.createElement(S.layoutNodeMap))})}render(){this.renderNodes(),this.addEventListeners(),this.setToolBox(this.setSVGPanZoom())}addEventListeners(){let e=document.querySelector("#viewport");[...e.querySelectorAll(".nodeWraper")].forEach(e=>{let t=new x("node"),o=e.querySelector(".nodeRect");e.addEventListener("mouseenter",()=>{let{name:n}=e.dataset,{left:i,top:s,width:a}=o.getBoundingClientRect();t.show({left:i,top:s,text:n,dx:a/2})}),e.addEventListener("mouseleave",()=>{t.hide()})}),[...e.querySelectorAll(".nodeLink")].forEach(t=>{let o=new x("link");t.addEventListener("mouseenter",n=>{o.show({left:n.clientX,top:n.clientY,text:`${t.dataset.source} --> ${t.dataset.target}`})}),t.addEventListener("mouseleave",()=>{o.hide()})})}setSVGPanZoom(){const{svgPanZoomConfig:e}=this.initOptions;return svgPanZoom("#viewport",e)}setToolBox(e){const{toolBox:t}=this.initOptions;if(!t)return;const o=new C(e);requestAnimationFrame(()=>{const e=o.create("#viewport");document.body.appendChild(e)})}}S.layoutNodeMap={};class E{constructor(e={}){this.initOptions=this.mergeInitOptions(e)}mergeInitOptions(e){let t={width:"100%",height:"100%",backgroundColor:"transparent",svgPanZoomConfig:{},toolBox:!0},o={svgPanZoomConfig:r(t.svgPanZoomConfig,e.svgPanZoomConfig,!0)};return Object.assign(t,e,o)}mergeRenderOptions(e){let{nodes:t,links:o}=e,n={linkConfig:{linkType:"curve"},rowConfig:{gap:100,height:35},columnConfig:{gap:20},node:{icon:{id:"spark_icon"},formatter(e){return a(e.name,20)}}};return this.renderOptions={linkConfig:r(n.linkConfig,e.linkConfig,!0),rowConfig:r(n.rowConfig,e.rowConfig,!0),columnConfig:r(n.columnConfig,e.columnConfig,!0),nodes:t,links:o,node:r(n.node,e.node,!0)}}render(e={}){const{nodes:t,links:o}=this.mergeRenderOptions(e);t.length&&o.length&&(this.reset(),this.build(this.renderOptions))}reset(){c.nodeMap={},S.layoutNodeMap={}}build(e){const{nodes:t,links:o,linkConfig:n,rowConfig:i,columnConfig:s,node:a}=e;let r=o.reduce((e,o)=>{let{exist:i,link:s}=h.create(o,{nodes:t,linkConfig:n});return i||e.push(s),e},[]),l={},d=r.filter(e=>{let{sourceNode:t}=e,o=t.getInCount();if(0===o&&!l[t.id])return l[t.id]=t,!0}).map(e=>e.sourceNode),p=this.layout(d);p.build({rowConfig:i,columnConfig:s,node:a}),p.render()}layout(e){let t=[e],o={},{row:n,pushToNextRow:i}=this.getRowFromParent({parentNodes:e,layoutNodeMap:o});for(;n.length;){t.push(n);let e=this.getRowFromParent({parentNodes:n,layoutNodeMap:o,readyForPush:i});n=e.row,i=e.pushToNextRow}let s=new S({matrix:t,initOptions:this.initOptions});return s}getRowFromParent({parentNodes:e,layoutNodeMap:t,readyForPush:o}){let n={},s=[],a={};for(let r=0;r<e.length;r++){let i=e[r],l=i.getTargetNodes();r==e.length-1&&(l=l.concat(o||[])),l.forEach(e=>{n[e.id]||t[e.id]||(a[e.id]=[],e.links.source.forEach(t=>{a[e.id].push(t.targetNode.id)}),n[e.id]=e,t[e.id]=e,s.push(e))})}let r=[];for(let n=s.length-1;0<=n;n--){let e=s[n],o=a[e.id],i=[];s.every((e,t)=>{let n=o.includes(e.id);return n&&(r.push(e),i.push(t)),n}),i.forEach(e=>{delete t[s[e].id],s.splice(e,1)})}return{row:s,pushToNextRow:r}}}var M={init(e){return new E(e)}};return window.Graph=M,M});
